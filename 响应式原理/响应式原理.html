<!DOCTYPE html><html><head>
      <title>&#x54CD;&#x5E94;&#x5F0F;&#x539F;&#x7406;</title>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      
      <link rel="stylesheet" href="file:///C:\Users\admin\.vscode\extensions\shd101wyy.markdown-preview-enhanced-0.3.11\node_modules\@shd101wyy\mume\dependencies\katex\katex.min.css">
      
      
      
      
      
      
      
      
      

      <style> 
      /**
 * prism.js Github theme based on GitHub's theme.
 * @author Sam Clarke
 */
code[class*="language-"],
pre[class*="language-"] {
  color: #333;
  background: none;
  font-family: Consolas, "Liberation Mono", Menlo, Courier, monospace;
  text-align: left;
  white-space: pre;
  word-spacing: normal;
  word-break: normal;
  word-wrap: normal;
  line-height: 1.4;

  -moz-tab-size: 8;
  -o-tab-size: 8;
  tab-size: 8;

  -webkit-hyphens: none;
  -moz-hyphens: none;
  -ms-hyphens: none;
  hyphens: none;
}

/* Code blocks */
pre[class*="language-"] {
  padding: .8em;
  overflow: auto;
  /* border: 1px solid #ddd; */
  border-radius: 3px;
  /* background: #fff; */
  background: #f5f5f5;
}

/* Inline code */
:not(pre) > code[class*="language-"] {
  padding: .1em;
  border-radius: .3em;
  white-space: normal;
  background: #f5f5f5;
}

.token.comment,
.token.blockquote {
  color: #969896;
}

.token.cdata {
  color: #183691;
}

.token.doctype,
.token.punctuation,
.token.variable,
.token.macro.property {
  color: #333;
}

.token.operator,
.token.important,
.token.keyword,
.token.rule,
.token.builtin {
  color: #a71d5d;
}

.token.string,
.token.url,
.token.regex,
.token.attr-value {
  color: #183691;
}

.token.property,
.token.number,
.token.boolean,
.token.entity,
.token.atrule,
.token.constant,
.token.symbol,
.token.command,
.token.code {
  color: #0086b3;
}

.token.tag,
.token.selector,
.token.prolog {
  color: #63a35c;
}

.token.function,
.token.namespace,
.token.pseudo-element,
.token.class,
.token.class-name,
.token.pseudo-class,
.token.id,
.token.url-reference .token.variable,
.token.attr-name {
  color: #795da3;
}

.token.entity {
  cursor: help;
}

.token.title,
.token.title .token.punctuation {
  font-weight: bold;
  color: #1d3e81;
}

.token.list {
  color: #ed6a43;
}

.token.inserted {
  background-color: #eaffea;
  color: #55a532;
}

.token.deleted {
  background-color: #ffecec;
  color: #bd2c00;
}

.token.bold {
  font-weight: bold;
}

.token.italic {
  font-style: italic;
}


/* JSON */
.language-json .token.property {
  color: #183691;
}

.language-markup .token.tag .token.punctuation {
  color: #333;
}

/* CSS */
code.language-css,
.language-css .token.function {
  color: #0086b3;
}

/* YAML */
.language-yaml .token.atrule {
  color: #63a35c;
}

code.language-yaml {
  color: #183691;
}

/* Ruby */
.language-ruby .token.function {
  color: #333;
}

/* Markdown */
.language-markdown .token.url {
  color: #795da3;
}

/* Makefile */
.language-makefile .token.symbol {
  color: #795da3;
}

.language-makefile .token.variable {
  color: #183691;
}

.language-makefile .token.builtin {
  color: #0086b3;
}

/* Bash */
.language-bash .token.keyword {
  color: #0086b3;
}html body{font-family:"Helvetica Neue",Helvetica,"Segoe UI",Arial,freesans,sans-serif;font-size:16px;line-height:1.6;color:#333;background-color:#fff;overflow:initial;box-sizing:border-box;word-wrap:break-word}html body>:first-child{margin-top:0}html body h1,html body h2,html body h3,html body h4,html body h5,html body h6{line-height:1.2;margin-top:1em;margin-bottom:16px;color:#000}html body h1{font-size:2.25em;font-weight:300;padding-bottom:.3em}html body h2{font-size:1.75em;font-weight:400;padding-bottom:.3em}html body h3{font-size:1.5em;font-weight:500}html body h4{font-size:1.25em;font-weight:600}html body h5{font-size:1.1em;font-weight:600}html body h6{font-size:1em;font-weight:600}html body h1,html body h2,html body h3,html body h4,html body h5{font-weight:600}html body h5{font-size:1em}html body h6{color:#5c5c5c}html body strong{color:#000}html body del{color:#5c5c5c}html body a:not([href]){color:inherit;text-decoration:none}html body a{color:#08c;text-decoration:none}html body a:hover{color:#00a3f5;text-decoration:none}html body img{max-width:100%}html body>p{margin-top:0;margin-bottom:16px;word-wrap:break-word}html body>ul,html body>ol{margin-bottom:16px}html body ul,html body ol{padding-left:2em}html body ul.no-list,html body ol.no-list{padding:0;list-style-type:none}html body ul ul,html body ul ol,html body ol ol,html body ol ul{margin-top:0;margin-bottom:0}html body li{margin-bottom:0}html body li.task-list-item{list-style:none}html body li>p{margin-top:0;margin-bottom:0}html body .task-list-item-checkbox{margin:0 .2em .25em -1.8em;vertical-align:middle}html body .task-list-item-checkbox:hover{cursor:pointer}html body blockquote{margin:16px 0;font-size:inherit;padding:0 15px;color:#5c5c5c;border-left:4px solid #d6d6d6}html body blockquote>:first-child{margin-top:0}html body blockquote>:last-child{margin-bottom:0}html body hr{height:4px;margin:32px 0;background-color:#d6d6d6;border:0 none}html body table{margin:10px 0 15px 0;border-collapse:collapse;border-spacing:0;display:block;width:100%;overflow:auto;word-break:normal;word-break:keep-all}html body table th{font-weight:bold;color:#000}html body table td,html body table th{border:1px solid #d6d6d6;padding:6px 13px}html body dl{padding:0}html body dl dt{padding:0;margin-top:16px;font-size:1em;font-style:italic;font-weight:bold}html body dl dd{padding:0 16px;margin-bottom:16px}html body code{font-family:Menlo,Monaco,Consolas,'Courier New',monospace;font-size:.85em !important;color:#000;background-color:#f0f0f0;border-radius:3px;padding:.2em 0}html body code::before,html body code::after{letter-spacing:-0.2em;content:"\00a0"}html body pre>code{padding:0;margin:0;font-size:.85em !important;word-break:normal;white-space:pre;background:transparent;border:0}html body .highlight{margin-bottom:16px}html body .highlight pre,html body pre{padding:1em;overflow:auto;font-size:.85em !important;line-height:1.45;border:#d6d6d6;border-radius:3px}html body .highlight pre{margin-bottom:0;word-break:normal}html body pre code,html body pre tt{display:inline;max-width:initial;padding:0;margin:0;overflow:initial;line-height:inherit;word-wrap:normal;background-color:transparent;border:0}html body pre code:before,html body pre tt:before,html body pre code:after,html body pre tt:after{content:normal}html body p,html body blockquote,html body ul,html body ol,html body dl,html body pre{margin-top:0;margin-bottom:16px}html body kbd{color:#000;border:1px solid #d6d6d6;border-bottom:2px solid #c7c7c7;padding:2px 4px;background-color:#f0f0f0;border-radius:3px}@media print{html body{background-color:#fff}html body h1,html body h2,html body h3,html body h4,html body h5,html body h6{color:#000;page-break-after:avoid}html body blockquote{color:#5c5c5c}html body pre{page-break-inside:avoid}html body table{display:table}html body img{display:block;max-width:100%;max-height:100%}html body pre,html body code{word-wrap:break-word;white-space:pre}}.markdown-preview{width:100%;height:100%;box-sizing:border-box}.markdown-preview .pagebreak,.markdown-preview .newpage{page-break-before:always}.markdown-preview pre.line-numbers{position:relative;padding-left:3.8em;counter-reset:linenumber}.markdown-preview pre.line-numbers>code{position:relative}.markdown-preview pre.line-numbers .line-numbers-rows{position:absolute;pointer-events:none;top:1em;font-size:100%;left:0;width:3em;letter-spacing:-1px;border-right:1px solid #999;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.markdown-preview pre.line-numbers .line-numbers-rows>span{pointer-events:none;display:block;counter-increment:linenumber}.markdown-preview pre.line-numbers .line-numbers-rows>span:before{content:counter(linenumber);color:#999;display:block;padding-right:.8em;text-align:right}.markdown-preview .mathjax-exps .MathJax_Display{text-align:center !important}.markdown-preview:not([for="preview"]) .code-chunk .btn-group{display:none}.markdown-preview:not([for="preview"]) .code-chunk .status{display:none}.markdown-preview:not([for="preview"]) .code-chunk .output-div{margin-bottom:16px}.scrollbar-style::-webkit-scrollbar{width:8px}.scrollbar-style::-webkit-scrollbar-track{border-radius:10px;background-color:transparent}.scrollbar-style::-webkit-scrollbar-thumb{border-radius:5px;background-color:rgba(150,150,150,0.66);border:4px solid rgba(150,150,150,0.66);background-clip:content-box}html body[for="html-export"]:not([data-presentation-mode]){position:relative;width:100%;height:100%;top:0;left:0;margin:0;padding:0;overflow:auto}html body[for="html-export"]:not([data-presentation-mode]) .markdown-preview{position:relative;top:0}@media screen and (min-width:914px){html body[for="html-export"]:not([data-presentation-mode]) .markdown-preview{padding:2em calc(50% - 457px)}}@media screen and (max-width:914px){html body[for="html-export"]:not([data-presentation-mode]) .markdown-preview{padding:2em}}@media screen and (max-width:450px){html body[for="html-export"]:not([data-presentation-mode]) .markdown-preview{font-size:14px !important;padding:1em}}@media print{html body[for="html-export"]:not([data-presentation-mode]) #sidebar-toc-btn{display:none}}html body[for="html-export"]:not([data-presentation-mode]) #sidebar-toc-btn{position:fixed;bottom:8px;left:8px;font-size:28px;cursor:pointer;color:inherit;z-index:99;width:32px;text-align:center;opacity:.4}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] #sidebar-toc-btn{opacity:1}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc{position:fixed;top:0;left:0;width:300px;height:100%;padding:32px 0 48px 0;font-size:14px;box-shadow:0 0 4px rgba(150,150,150,0.33);box-sizing:border-box;overflow:auto;background-color:inherit}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar{width:8px}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar-track{border-radius:10px;background-color:transparent}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar-thumb{border-radius:5px;background-color:rgba(150,150,150,0.66);border:4px solid rgba(150,150,150,0.66);background-clip:content-box}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc a{text-decoration:none}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc ul{padding:0 1.6em;margin-top:.8em}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc li{margin-bottom:.8em}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc ul{list-style-type:none}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{left:300px;width:calc(100% -  300px);padding:2em calc(50% - 457px -  150px);margin:0;box-sizing:border-box}@media screen and (max-width:1274px){html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{padding:2em}}@media screen and (max-width:450px){html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{width:100%}}html body[for="html-export"]:not([data-presentation-mode]):not([html-show-sidebar-toc]) .markdown-preview{left:50%;transform:translateX(-50%)}html body[for="html-export"]:not([data-presentation-mode]):not([html-show-sidebar-toc]) .md-sidebar-toc{display:none}
/* Please visit the URL below for more information: */
/*   https://shd101wyy.github.io/markdown-preview-enhanced/#/customize-css */
 
      </style>
    </head>
    <body for="html-export">
      <div class="mume markdown-preview   ">
      <h1 class="mume-header" id="vue%E5%93%8D%E5%BA%94%E5%BC%8F%E5%8E%9F%E7%90%86">Vue&#x54CD;&#x5E94;&#x5F0F;&#x539F;&#x7406;</h1>

<p>&#x4E3B;&#x8981;&#x662F;&#x8BF4;&#x660E;&#x54CD;&#x5E94;&#x5F0F;&#x5BF9;&#x8C61;&#x662F;&#x5982;&#x4F55;&#x751F;&#x6210;&#x7684;&#xFF0C;&#x4EE5;&#x53CA;&#x5982;&#x4F55;&#x5B9E;&#x73B0;&#x54CD;&#x5E94;&#x5F0F;&#x3002;</p>
<h2 class="mume-header" id="objectdefineproperty">Object.defineProperty</h2>

<pre data-role="codeBlock" data-info="js" class="language-javascript">Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> prop<span class="token punctuation">,</span> descriptor<span class="token punctuation">)</span>
</pre><blockquote>
<p>&#x53C2;&#x6570;<br>
obj: &#x8981;&#x5728;&#x5176;&#x4E0A;&#x5B9A;&#x4E49;&#x5C5E;&#x6027;&#x7684;&#x5BF9;&#x8C61;&#x3002;<br>
prop: &#x8981;&#x5B9A;&#x4E49;&#x6216;&#x4FEE;&#x6539;&#x7684;&#x5C5E;&#x6027;&#x7684;&#x540D;&#x79F0;&#x3002;<br>
descriptor: &#x5C06;&#x88AB;&#x5B9A;&#x4E49;&#x6216;&#x4FEE;&#x6539;&#x7684;&#x5C5E;&#x6027;&#x63CF;&#x8FF0;&#x7B26;&#x3002;</p>
</blockquote>
<blockquote>
<p>&#x5C5E;&#x6027;&#x63CF;&#x8FF0;&#x7B26;<br>
&#x5BF9;&#x8C61;&#x91CC;&#x76EE;&#x524D;&#x5B58;&#x5728;&#x7684;&#x5C5E;&#x6027;&#x63CF;&#x8FF0;&#x7B26;&#x6709;&#x4E24;&#x79CD;&#x4E3B;&#x8981;&#x5F62;&#x5F0F;&#xFF1A;&#x6570;&#x636E;&#x63CF;&#x8FF0;&#x7B26;&#x548C;&#x5B58;&#x53D6;&#x63CF;&#x8FF0;&#x7B26;&#x3002;&#x6570;&#x636E;&#x63CF;&#x8FF0;&#x7B26;&#x662F;&#x4E00;&#x4E2A;&#x5177;&#x6709;&#x503C;&#x7684;&#x5C5E;&#x6027;&#xFF0C;&#x8BE5;&#x503C;&#x53EF;&#x80FD;&#x662F;&#x53EF;&#x5199;&#x7684;&#xFF0C;&#x4E5F;&#x53EF;&#x80FD;&#x4E0D;&#x662F;&#x53EF;&#x5199;&#x7684;&#x3002;&#x5B58;&#x53D6;&#x63CF;&#x8FF0;&#x7B26;&#x662F;&#x7531;getter-setter&#x51FD;&#x6570;&#x5BF9;&#x63CF;&#x8FF0;&#x7684;&#x5C5E;&#x6027;&#x3002;&#x63CF;&#x8FF0;&#x7B26;&#x5FC5;&#x987B;&#x662F;&#x8FD9;&#x4E24;&#x79CD;&#x5F62;&#x5F0F;&#x4E4B;&#x4E00;&#xFF1B;&#x4E0D;&#x80FD;&#x540C;&#x65F6;&#x662F;&#x4E24;&#x8005;&#x3002;</p>
</blockquote>
<blockquote>
<p>&#x6570;&#x636E;&#x63CF;&#x8FF0;&#x7B26;&#x548C;&#x5B58;&#x53D6;&#x63CF;&#x8FF0;&#x7B26;&#x5747;&#x5177;&#x6709;&#x4EE5;&#x4E0B;&#x53EF;&#x9009;&#x952E;&#x503C;&#xFF1A;<br>
configurable: &#x5F53;&#x4E14;&#x4EC5;&#x5F53;&#x8BE5;&#x5C5E;&#x6027;&#x7684; configurable &#x4E3A; true &#x65F6;&#xFF0C;&#x8BE5;&#x5C5E;&#x6027;&#x63CF;&#x8FF0;&#x7B26;&#x624D;&#x80FD;&#x591F;&#x88AB;&#x6539;&#x53D8;&#xFF0C;&#x540C;&#x65F6;&#x8BE5;&#x5C5E;&#x6027;&#x4E5F;&#x80FD;&#x4ECE;&#x5BF9;&#x5E94;&#x7684;&#x5BF9;&#x8C61;&#x4E0A;&#x88AB;&#x5220;&#x9664;&#x3002;&#x9ED8;&#x8BA4;&#x4E3A; false&#x3002;<br>
enumerable: &#x5F53;&#x4E14;&#x4EC5;&#x5F53;&#x8BE5;&#x5C5E;&#x6027;&#x7684;enumerable&#x4E3A;true&#x65F6;&#xFF0C;&#x8BE5;&#x5C5E;&#x6027;&#x624D;&#x80FD;&#x591F;&#x51FA;&#x73B0;&#x5728;&#x5BF9;&#x8C61;&#x7684;&#x679A;&#x4E3E;&#x5C5E;&#x6027;&#x4E2D;&#x3002;&#x9ED8;&#x8BA4;&#x4E3A; false&#x3002;</p>
</blockquote>
<blockquote>
<p>&#x6570;&#x636E;&#x63CF;&#x8FF0;&#x7B26;&#x540C;&#x65F6;&#x5177;&#x6709;&#x4EE5;&#x4E0B;&#x53EF;&#x9009;&#x952E;&#x503C;&#xFF1A;<br>
value: &#x8BE5;&#x5C5E;&#x6027;&#x5BF9;&#x5E94;&#x7684;&#x503C;&#x3002;&#x53EF;&#x4EE5;&#x662F;&#x4EFB;&#x4F55;&#x6709;&#x6548;&#x7684; JavaScript &#x503C;&#xFF08;&#x6570;&#x503C;&#xFF0C;&#x5BF9;&#x8C61;&#xFF0C;&#x51FD;&#x6570;&#x7B49;&#xFF09;&#x3002;&#x9ED8;&#x8BA4;&#x4E3A; undefined&#x3002;<br>
writable: &#x5F53;&#x4E14;&#x4EC5;&#x5F53;&#x8BE5;&#x5C5E;&#x6027;&#x7684;writable&#x4E3A;true&#x65F6;&#xFF0C;value&#x624D;&#x80FD;&#x88AB;&#x8D4B;&#x503C;&#x8FD0;&#x7B97;&#x7B26;&#x6539;&#x53D8;&#x3002;&#x9ED8;&#x8BA4;&#x4E3A; false&#x3002;</p>
</blockquote>
<blockquote>
<p>&#x5B58;&#x53D6;&#x63CF;&#x8FF0;&#x7B26;&#x540C;&#x65F6;&#x5177;&#x6709;&#x4EE5;&#x4E0B;&#x53EF;&#x9009;&#x952E;&#x503C;&#xFF1A;<br>
get: &#x4E00;&#x4E2A;&#x7ED9;&#x5C5E;&#x6027;&#x63D0;&#x4F9B; getter &#x7684;&#x65B9;&#x6CD5;&#xFF0C;&#x5982;&#x679C;&#x6CA1;&#x6709; getter &#x5219;&#x4E3A; undefined&#x3002;&#x5F53;&#x8BBF;&#x95EE;&#x8BE5;&#x5C5E;&#x6027;&#x65F6;&#xFF0C;&#x8BE5;&#x65B9;&#x6CD5;&#x4F1A;&#x88AB;&#x6267;&#x884C;&#xFF0C;&#x65B9;&#x6CD5;&#x6267;&#x884C;&#x65F6;&#x6CA1;&#x6709;&#x53C2;&#x6570;&#x4F20;&#x5165;&#xFF0C;&#x4F46;&#x662F;&#x4F1A;&#x4F20;&#x5165;this&#x5BF9;&#x8C61;&#xFF08;&#x7531;&#x4E8E;&#x7EE7;&#x627F;&#x5173;&#x7CFB;&#xFF0C;&#x8FD9;&#x91CC;&#x7684;this&#x5E76;&#x4E0D;&#x4E00;&#x5B9A;&#x662F;&#x5B9A;&#x4E49;&#x8BE5;&#x5C5E;&#x6027;&#x7684;&#x5BF9;&#x8C61;&#xFF09;&#x3002;&#x9ED8;&#x8BA4;&#x4E3A; undefined&#x3002;<br>
set&#xFF1A;&#x4E00;&#x4E2A;&#x7ED9;&#x5C5E;&#x6027;&#x63D0;&#x4F9B; setter &#x7684;&#x65B9;&#x6CD5;&#xFF0C;&#x5982;&#x679C;&#x6CA1;&#x6709; setter &#x5219;&#x4E3A; undefined&#x3002;&#x5F53;&#x5C5E;&#x6027;&#x503C;&#x4FEE;&#x6539;&#x65F6;&#xFF0C;&#x89E6;&#x53D1;&#x6267;&#x884C;&#x8BE5;&#x65B9;&#x6CD5;&#x3002;&#x8BE5;&#x65B9;&#x6CD5;&#x5C06;&#x63A5;&#x53D7;&#x552F;&#x4E00;&#x53C2;&#x6570;&#xFF0C;&#x5373;&#x8BE5;&#x5C5E;&#x6027;&#x65B0;&#x7684;&#x53C2;&#x6570;&#x503C;&#x3002;&#x9ED8;&#x8BA4;&#x4E3A; undefined&#x3002;</p>
</blockquote>
<h2 class="mume-header" id="%E8%A7%82%E5%AF%9F%E8%80%85%E6%A8%A1%E5%BC%8F">&#x89C2;&#x5BDF;&#x8005;&#x6A21;&#x5F0F;</h2>

<p><img src="%E8%A7%82%E5%AF%9F%E8%80%85%E6%A8%A1%E5%BC%8F.png" alt="&#x89C2;&#x5BDF;&#x8005;&#x6A21;&#x5F0F;">;</p>
<blockquote>
<p>&#x76EE;&#x6807;&#x548C;&#x89C2;&#x5BDF;&#x8005;&#x662F;&#x57FA;&#x7C7B;&#xFF0C;&#x76EE;&#x6807;&#x63D0;&#x4F9B;&#x7EF4;&#x62A4;&#x89C2;&#x5BDF;&#x8005;&#x7684;&#x4E00;&#x7CFB;&#x5217;&#x65B9;&#x6CD5;&#xFF0C;&#x89C2;&#x5BDF;&#x8005;&#x63D0;&#x4F9B;&#x66F4;&#x65B0;&#x63A5;&#x53E3;&#x3002;&#x5177;&#x4F53;&#x89C2;&#x5BDF;&#x8005;&#x548C;&#x5177;&#x4F53;&#x76EE;&#x6807;&#x7EE7;&#x627F;&#x5404;&#x81EA;&#x7684;&#x57FA;&#x7C7B;&#xFF0C;&#x7136;&#x540E;&#x5177;&#x4F53;&#x89C2;&#x5BDF;&#x8005;&#x628A;&#x81EA;&#x5DF1;&#x6CE8;&#x518C;&#x5230;&#x5177;&#x4F53;&#x76EE;&#x6807;&#x91CC;&#xFF0C;&#x5728;&#x5177;&#x4F53;&#x76EE;&#x6807;&#x53D1;&#x751F;&#x53D8;&#x5316;&#x65F6;&#x5019;&#xFF0C;&#x8C03;&#x5EA6;&#x89C2;&#x5BDF;&#x8005;&#x7684;&#x66F4;&#x65B0;&#x65B9;&#x6CD5;&#x3002;</p>
</blockquote>
<blockquote>
<p>&#x6BD4;&#x5982;&#x6709;&#x4E2A;&#x201C;&#x5929;&#x6C14;&#x4E2D;&#x5FC3;&#x201D;&#x7684;&#x5177;&#x4F53;&#x76EE;&#x6807;A&#xFF0C;&#x4E13;&#x95E8;&#x76D1;&#x542C;&#x5929;&#x6C14;&#x53D8;&#x5316;&#xFF0C;&#x800C;&#x6709;&#x4E2A;&#x663E;&#x793A;&#x5929;&#x6C14;&#x7684;&#x754C;&#x9762;&#x7684;&#x89C2;&#x5BDF;&#x8005;B&#xFF0C;B&#x5C31;&#x628A;&#x81EA;&#x5DF1;&#x6CE8;&#x518C;&#x5230;A&#x91CC;&#xFF0C;&#x5F53;A&#x89E6;&#x53D1;&#x5929;&#x6C14;&#x53D8;&#x5316;&#xFF0C;&#x5C31;&#x8C03;&#x5EA6;B&#x7684;&#x66F4;&#x65B0;&#x65B9;&#x6CD5;&#xFF0C;&#x5E76;&#x5E26;&#x4E0A;&#x81EA;&#x5DF1;&#x7684;&#x4E0A;&#x4E0B;&#x6587;&#x3002;</p>
</blockquote>
<h2 class="mume-header" id="%E5%8F%91%E5%B8%83%E8%AE%A2%E9%98%85%E6%A8%A1%E5%BC%8F">&#x53D1;&#x5E03;/&#x8BA2;&#x9605;&#x6A21;&#x5F0F;</h2>

<p><img src="%E5%8F%91%E5%B8%83%E8%AE%A2%E9%98%85%E6%A8%A1%E5%BC%8F.png" alt="&#x53D1;&#x5E03;/&#x8BA2;&#x9605;&#x6A21;&#x5F0F;">;</p>
<blockquote>
<p>&#x8BA2;&#x9605;&#x8005;&#x628A;&#x81EA;&#x5DF1;&#x60F3;&#x8BA2;&#x9605;&#x7684;&#x4E8B;&#x4EF6;&#x6CE8;&#x518C;&#x5230;&#x8C03;&#x5EA6;&#x4E2D;&#x5FC3;&#xFF0C;&#x5F53;&#x8BE5;&#x4E8B;&#x4EF6;&#x89E6;&#x53D1;&#x65F6;&#x5019;&#xFF0C;&#x53D1;&#x5E03;&#x8005;&#x53D1;&#x5E03;&#x8BE5;&#x4E8B;&#x4EF6;&#x5230;&#x8C03;&#x5EA6;&#x4E2D;&#x5FC3;&#xFF08;&#x987A;&#x5E26;&#x4E0A;&#x4E0B;&#x6587;&#xFF09;&#xFF0C;&#x7531;&#x8C03;&#x5EA6;&#x4E2D;&#x5FC3;&#x7EDF;&#x4E00;&#x8C03;&#x5EA6;&#x8BA2;&#x9605;&#x8005;&#x6CE8;&#x518C;&#x5230;&#x8C03;&#x5EA6;&#x4E2D;&#x5FC3;&#x7684;&#x5904;&#x7406;&#x4EE3;&#x7801;&#x3002;</p>
</blockquote>
<blockquote>
<p>&#x6BD4;&#x5982;&#x6709;&#x4E2A;&#x754C;&#x9762;&#x662F;&#x5B9E;&#x65F6;&#x663E;&#x793A;&#x5929;&#x6C14;&#xFF0C;&#x5B83;&#x5C31;&#x8BA2;&#x9605;&#x5929;&#x6C14;&#x4E8B;&#x4EF6;&#xFF08;&#x6CE8;&#x518C;&#x5230;&#x8C03;&#x5EA6;&#x4E2D;&#x5FC3;&#xFF0C;&#x5305;&#x62EC;&#x5904;&#x7406;&#x7A0B;&#x5E8F;&#xFF09;&#xFF0C;&#x5F53;&#x5929;&#x6C14;&#x53D8;&#x5316;&#x65F6;&#xFF08;&#x5B9A;&#x65F6;&#x83B7;&#x53D6;&#x6570;&#x636E;&#xFF09;&#xFF0C;&#x5C31;&#x4F5C;&#x4E3A;&#x53D1;&#x5E03;&#x8005;&#x53D1;&#x5E03;&#x5929;&#x6C14;&#x4FE1;&#x606F;&#x5230;&#x8C03;&#x5EA6;&#x4E2D;&#x5FC3;&#xFF0C;&#x8C03;&#x5EA6;&#x4E2D;&#x5FC3;&#x5C31;&#x8C03;&#x5EA6;&#x8BA2;&#x9605;&#x8005;&#x7684;&#x5929;&#x6C14;&#x5904;&#x7406;&#x7A0B;&#x5E8F;&#x3002;</p>
</blockquote>
<h3 class="mume-header" id="%E5%8C%BA%E5%88%AB%E8%B0%83%E5%BA%A6%E7%9A%84%E5%9C%B0%E6%96%B9">&#x533A;&#x522B;&#xFF08;&#x8C03;&#x5EA6;&#x7684;&#x5730;&#x65B9;&#xFF09;</h3>

<blockquote>
<p>&#x867D;&#x7136;&#x4E24;&#x79CD;&#x6A21;&#x5F0F;&#x90FD;&#x5B58;&#x5728;&#x8BA2;&#x9605;&#x8005;&#x548C;&#x53D1;&#x5E03;&#x8005;&#xFF08;&#x5177;&#x4F53;&#x89C2;&#x5BDF;&#x8005;&#x53EF;&#x8BA4;&#x4E3A;&#x662F;&#x8BA2;&#x9605;&#x8005;&#x3001;&#x5177;&#x4F53;&#x76EE;&#x6807;&#x53EF;&#x8BA4;&#x4E3A;&#x662F;&#x53D1;&#x5E03;&#x8005;&#xFF09;&#xFF0C;&#x4F46;&#x662F;&#x89C2;&#x5BDF;&#x8005;&#x6A21;&#x5F0F;&#x662F;&#x7531;&#x5177;&#x4F53;&#x76EE;&#x6807;&#x8C03;&#x5EA6;&#x7684;&#xFF0C;&#x800C;&#x53D1;&#x5E03;/&#x8BA2;&#x9605;&#x6A21;&#x5F0F;&#x662F;&#x7EDF;&#x4E00;&#x7531;&#x8C03;&#x5EA6;&#x4E2D;&#x5FC3;&#x8C03;&#x7684;&#xFF0C;&#x6240;&#x4EE5;&#x89C2;&#x5BDF;&#x8005;&#x6A21;&#x5F0F;&#x7684;&#x8BA2;&#x9605;&#x8005;&#x4E0E;&#x53D1;&#x5E03;&#x8005;&#x4E4B;&#x95F4;&#x662F;&#x5B58;&#x5728;&#x4F9D;&#x8D56;&#x7684;&#xFF0C;&#x800C;&#x53D1;&#x5E03;/&#x8BA2;&#x9605;&#x6A21;&#x5F0F;&#x5219;&#x4E0D;&#x4F1A;&#x3002;</p>
</blockquote>
<h2 class="mume-header" id="vue%E7%9A%84%E6%9E%84%E9%80%A0%E5%87%BD%E6%95%B0">vue&#x7684;&#x6784;&#x9020;&#x51FD;&#x6570;</h2>

<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token keyword">import</span> <span class="token punctuation">{</span> initMixin <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&apos;./init&apos;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> stateMixin <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&apos;./state&apos;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> renderMixin <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&apos;./render&apos;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> eventsMixin <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&apos;./events&apos;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> lifecycleMixin <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&apos;./lifecycle&apos;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> warn <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&apos;../util/index&apos;</span>
<span class="token keyword">function</span> <span class="token function">Vue</span> <span class="token punctuation">(</span>options<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">!==</span> <span class="token string">&apos;production&apos;</span> <span class="token operator">&amp;&amp;</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token keyword">this</span> <span class="token keyword">instanceof</span> <span class="token class-name">Vue</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">&apos;Vue is a constructor and should be called with the `new` keyword&apos;</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_init</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token function">initMixin</span><span class="token punctuation">(</span>Vue<span class="token punctuation">)</span>
<span class="token function">stateMixin</span><span class="token punctuation">(</span>Vue<span class="token punctuation">)</span>
<span class="token function">eventsMixin</span><span class="token punctuation">(</span>Vue<span class="token punctuation">)</span>
<span class="token function">lifecycleMixin</span><span class="token punctuation">(</span>Vue<span class="token punctuation">)</span>
<span class="token function">renderMixin</span><span class="token punctuation">(</span>Vue<span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> Vue
</pre><p>vue&#x5373;&#x4E3A;&#x7528;function&#x5B9E;&#x73B0;&#x7684;&#x7C7B;&#xFF0C;&#x5176;&#x4E2D;&#x7684;xxxMixin()&#x4E00;&#x7C7B;&#x65B9;&#x6CD5;&#xFF0C;&#x90FD;&#x662F;&#x7ED9;&#x5B83;&#x7684;&#x539F;&#x578B;prototype&#x4E0A;&#x6269;&#x5C55;&#x65B9;&#x6CD5;&#xFF0C;&#x4F53;&#x73B0;&#x4E86;&#x5206;&#x6A21;&#x5757;&#x5B9E;&#x73B0;&#x601D;&#x60F3;&#x3002;</p>
<h2 class="mume-header" id="_init">_init</h2>

<pre data-role="codeBlock" data-info="js" class="language-javascript">Vue<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">_init</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>options<span class="token operator">?</span><span class="token punctuation">:</span> Object<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> vm<span class="token punctuation">:</span> Component <span class="token operator">=</span> <span class="token keyword">this</span>
    <span class="token comment">// a uid</span>
    vm<span class="token punctuation">.</span>_uid <span class="token operator">=</span> uid<span class="token operator">++</span>
    <span class="token keyword">let</span> startTag<span class="token punctuation">,</span> endTag
    <span class="token comment">/* istanbul ignore if */</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">!==</span> <span class="token string">&apos;production&apos;</span> <span class="token operator">&amp;&amp;</span> config<span class="token punctuation">.</span>performance <span class="token operator">&amp;&amp;</span> mark<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        startTag <span class="token operator">=</span> <span class="token template-string"><span class="token string">`vue-perf-start:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>vm<span class="token punctuation">.</span>_uid<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span>
        endTag <span class="token operator">=</span> <span class="token template-string"><span class="token string">`vue-perf-end:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>vm<span class="token punctuation">.</span>_uid<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span>
        <span class="token function">mark</span><span class="token punctuation">(</span>startTag<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// a flag to avoid this being observed</span>
    vm<span class="token punctuation">.</span>_isVue <span class="token operator">=</span> <span class="token boolean">true</span>
    <span class="token comment">// merge options</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>options <span class="token operator">&amp;&amp;</span> options<span class="token punctuation">.</span>_isComponent<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// optimize internal component instantiation</span>
    <span class="token comment">// since dynamic options merging is pretty slow, and none of the</span>
    <span class="token comment">// internal component options needs special treatment.</span>
        <span class="token function">initInternalComponent</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> options<span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        vm<span class="token punctuation">.</span>$options <span class="token operator">=</span> <span class="token function">mergeOptions</span><span class="token punctuation">(</span>
            <span class="token function">resolveConstructorOptions</span><span class="token punctuation">(</span>vm<span class="token punctuation">.</span>constructor<span class="token punctuation">)</span><span class="token punctuation">,</span>
            options <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
            vm
        <span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token comment">/* istanbul ignore else */</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">!==</span> <span class="token string">&apos;production&apos;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">initProxy</span><span class="token punctuation">(</span>vm<span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        vm<span class="token punctuation">.</span>_renderProxy <span class="token operator">=</span> vm
    <span class="token punctuation">}</span>
    <span class="token comment">// expose real self</span>
    vm<span class="token punctuation">.</span>_self <span class="token operator">=</span> vm
    <span class="token function">initLifecycle</span><span class="token punctuation">(</span>vm<span class="token punctuation">)</span>
    <span class="token function">initEvents</span><span class="token punctuation">(</span>vm<span class="token punctuation">)</span>
    <span class="token function">initRender</span><span class="token punctuation">(</span>vm<span class="token punctuation">)</span>
    <span class="token function">callHook</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> <span class="token string">&apos;beforeCreate&apos;</span><span class="token punctuation">)</span>
    <span class="token function">initInjections</span><span class="token punctuation">(</span>vm<span class="token punctuation">)</span> <span class="token comment">// resolve injections before data/props</span>
    <span class="token function">initState</span><span class="token punctuation">(</span>vm<span class="token punctuation">)</span>
    <span class="token function">initProvide</span><span class="token punctuation">(</span>vm<span class="token punctuation">)</span> <span class="token comment">// resolve provide after data/props</span>
    <span class="token function">callHook</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> <span class="token string">&apos;created&apos;</span><span class="token punctuation">)</span>
    <span class="token comment">/* istanbul ignore if */</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">!==</span> <span class="token string">&apos;production&apos;</span> <span class="token operator">&amp;&amp;</span> config<span class="token punctuation">.</span>performance <span class="token operator">&amp;&amp;</span> mark<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        vm<span class="token punctuation">.</span>_name <span class="token operator">=</span> <span class="token function">formatComponentName</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
        <span class="token function">mark</span><span class="token punctuation">(</span>endTag<span class="token punctuation">)</span>
        <span class="token function">measure</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`vue </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>vm<span class="token punctuation">.</span>_name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> init`</span></span><span class="token punctuation">,</span> startTag<span class="token punctuation">,</span> endTag<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>vm<span class="token punctuation">.</span>$options<span class="token punctuation">.</span>el<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        vm<span class="token punctuation">.</span><span class="token function">$mount</span><span class="token punctuation">(</span>vm<span class="token punctuation">.</span>$options<span class="token punctuation">.</span>el<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</pre><p>_init&#x65B9;&#x6CD5;&#x4E3B;&#x8981;&#x505A;&#x4E86;&#x4EE5;&#x4E0B;&#x4E8B;&#x60C5;&#xFF1A;&#x5408;&#x5E76;&#x914D;&#x7F6E;&#x3001;&#x521D;&#x59CB;&#x5316;&#x751F;&#x547D;&#x5468;&#x671F;&#x3001;&#x521D;&#x59CB;&#x5316;&#x4E8B;&#x4EF6;&#x4E2D;&#x5FC3;&#x3001;&#x521D;&#x59CB;&#x5316;&#x6E32;&#x67D3;&#x3001;&#x521D;&#x59CB;&#x5316;data&#x3001;props&#x3001;computed&#x3001;watcher&#x7B49;&#x3002;</p>
<h2 class="mume-header" id="initstate">initState</h2>

<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">initState</span> <span class="token punctuation">(</span>vm<span class="token punctuation">:</span> Component<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    vm<span class="token punctuation">.</span>_watchers <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">const</span> opts <span class="token operator">=</span> vm<span class="token punctuation">.</span>$options
    <span class="token keyword">if</span> <span class="token punctuation">(</span>opts<span class="token punctuation">.</span>props<span class="token punctuation">)</span> <span class="token function">initProps</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> opts<span class="token punctuation">.</span>props<span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>opts<span class="token punctuation">.</span>methods<span class="token punctuation">)</span> <span class="token function">initMethods</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> opts<span class="token punctuation">.</span>methods<span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>opts<span class="token punctuation">.</span>data<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">initData</span><span class="token punctuation">(</span>vm<span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token function">observe</span><span class="token punctuation">(</span>vm<span class="token punctuation">.</span>_data <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">true</span> <span class="token comment">/* asRootData */</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>opts<span class="token punctuation">.</span>computed<span class="token punctuation">)</span> <span class="token function">initComputed</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> opts<span class="token punctuation">.</span>computed<span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>opts<span class="token punctuation">.</span>watch <span class="token operator">&amp;&amp;</span> opts<span class="token punctuation">.</span>watch <span class="token operator">!==</span> nativeWatch<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">initWatch</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> opts<span class="token punctuation">.</span>watch<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</pre><p>initState &#x2F45;&#x6CD5;&#x4E3B;&#x8981;&#x662F;&#x5BF9; props &#x3001; methods &#x3001; data &#x3001; computed &#x548C; wathcer &#x7B49;&#x5C5E;&#x6027;&#x505A;&#x4E86;&#x521D;&#x59CB;&#x5316;&#x64CD;&#x4F5C;&#x3002;&#x6211;&#x4EEC;&#x5148;&#x770B; props &#x548C; data&#x3002;</p>
<h2 class="mume-header" id="initprops">initProps</h2>

<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token keyword">function</span> <span class="token function">initProps</span> <span class="token punctuation">(</span>vm<span class="token punctuation">:</span> Component<span class="token punctuation">,</span> propsOptions<span class="token punctuation">:</span> Object<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> propsData <span class="token operator">=</span> vm<span class="token punctuation">.</span>$options<span class="token punctuation">.</span>propsData <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token keyword">const</span> props <span class="token operator">=</span> vm<span class="token punctuation">.</span>_props <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token comment">// cache prop keys so that future props updates can iterate using Array</span>
  <span class="token comment">// instead of dynamic object key enumeration.</span>
  <span class="token keyword">const</span> keys <span class="token operator">=</span> vm<span class="token punctuation">.</span>$options<span class="token punctuation">.</span>_propKeys <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token keyword">const</span> isRoot <span class="token operator">=</span> <span class="token operator">!</span>vm<span class="token punctuation">.</span>$parent
  <span class="token comment">// root instance props should be converted</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>isRoot<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">toggleObserving</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> key <span class="token keyword">in</span> propsOptions<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    keys<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span>
    <span class="token keyword">const</span> value <span class="token operator">=</span> <span class="token function">validateProp</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> propsOptions<span class="token punctuation">,</span> propsData<span class="token punctuation">,</span> vm<span class="token punctuation">)</span>
    <span class="token comment">/* istanbul ignore else */</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">!==</span> <span class="token string">&apos;production&apos;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> hyphenatedKey <span class="token operator">=</span> <span class="token function">hyphenate</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isReservedAttribute</span><span class="token punctuation">(</span>hyphenatedKey<span class="token punctuation">)</span> <span class="token operator">||</span>
          config<span class="token punctuation">.</span><span class="token function">isReservedAttr</span><span class="token punctuation">(</span>hyphenatedKey<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">warn</span><span class="token punctuation">(</span>
          <span class="token template-string"><span class="token string">`&quot;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>hyphenatedKey<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&quot; is a reserved attribute and cannot be used as component prop.`</span></span><span class="token punctuation">,</span>
          vm
        <span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
      <span class="token function">defineReactive</span><span class="token punctuation">(</span>props<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>vm<span class="token punctuation">.</span>$parent <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>isUpdatingChildComponent<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token function">warn</span><span class="token punctuation">(</span>
            <span class="token template-string"><span class="token string">`Avoid mutating a prop directly since the value will be `</span></span> <span class="token operator">+</span>
            <span class="token template-string"><span class="token string">`overwritten whenever the parent component re-renders. `</span></span> <span class="token operator">+</span>
            <span class="token template-string"><span class="token string">`Instead, use a data or computed property based on the prop&apos;s `</span></span> <span class="token operator">+</span>
            <span class="token template-string"><span class="token string">`value. Prop being mutated: &quot;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>key<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&quot;`</span></span><span class="token punctuation">,</span>
            vm
          <span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token function">defineReactive</span><span class="token punctuation">(</span>props<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// static props are already proxied on the component&apos;s prototype</span>
    <span class="token comment">// during Vue.extend(). We only need to proxy props defined at</span>
    <span class="token comment">// instantiation here.</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span>key <span class="token keyword">in</span> vm<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">proxy</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> <span class="token template-string"><span class="token string">`_props`</span></span><span class="token punctuation">,</span> key<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token function">toggleObserving</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</pre><p>props &#x7684;&#x521D;&#x59CB;&#x5316;&#x4E3B;&#x8981;&#x8FC7;&#x7A0B;&#xFF0C;&#x5C31;&#x662F;&#x904D;&#x5386;&#x5B9A;&#x4E49;&#x7684; props &#x914D;&#x7F6E;&#x3002;&#x904D;&#x5386;&#x7684;&#x8FC7;&#x7A0B;&#x4E3B;&#x8981;&#x505A;&#x4E24;&#x4EF6;&#x4E8B;&#x60C5;&#xFF1A;&#x2F00;&#x4E2A;&#x662F;&#x8C03;&#x2F64; defineReactive &#x2F45;&#x6CD5;&#x628A;&#x6BCF;&#x4E2A; prop &#x5BF9;&#x5E94;&#x7684;&#x503C;&#x53D8;&#x6210;&#x54CD;&#x5E94;&#x5F0F;&#xFF0C;&#x53EF;&#x4EE5;&#x901A;&#x8FC7; vm._props.xxx &#x8BBF;&#x95EE;&#x5230;&#x5B9A;&#x4E49; props &#x4E2D;&#x5BF9;&#x5E94;&#x7684;&#x5C5E;&#x6027;&#x3002;&#x53E6;&#x2F00;&#x4E2A;&#x662F;&#x901A;&#x8FC7; proxy&#x628A; vm._props.xxx &#x7684;&#x8BBF;&#x95EE;&#x4EE3;&#x7406;&#x5230; <a href="http://vm.xxx">vm.xxx</a> &#x4E0A;&#x3002;&#x8FD9;&#x4E24;&#x4E2A;&#x2F45;&#x6CD5;&#xFF0C;&#x6211;&#x4EEC;&#x7A0D;&#x540E;&#x518D;&#x770B;&#x3002;</p>
<h2 class="mume-header" id="initdata">initData</h2>

<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token keyword">function</span> <span class="token function">initData</span> <span class="token punctuation">(</span>vm<span class="token punctuation">:</span> Component<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> data <span class="token operator">=</span> vm<span class="token punctuation">.</span>$options<span class="token punctuation">.</span>data
  data <span class="token operator">=</span> vm<span class="token punctuation">.</span>_data <span class="token operator">=</span> <span class="token keyword">typeof</span> data <span class="token operator">===</span> <span class="token string">&apos;function&apos;</span>
    <span class="token operator">?</span> <span class="token function">getData</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> vm<span class="token punctuation">)</span>
    <span class="token punctuation">:</span> data <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">isPlainObject</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    data <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">!==</span> <span class="token string">&apos;production&apos;</span> <span class="token operator">&amp;&amp;</span> <span class="token function">warn</span><span class="token punctuation">(</span>
      <span class="token string">&apos;data functions should return an object:\n&apos;</span> <span class="token operator">+</span>
      <span class="token string">&apos;https://vuejs.org/v2/guide/components.html#data-Must-Be-a-Function&apos;</span><span class="token punctuation">,</span>
      vm
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// proxy data on instance</span>
  <span class="token keyword">const</span> keys <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span> 
  <span class="token keyword">const</span> props <span class="token operator">=</span> vm<span class="token punctuation">.</span>$options<span class="token punctuation">.</span>props
  <span class="token keyword">const</span> methods <span class="token operator">=</span> vm<span class="token punctuation">.</span>$options<span class="token punctuation">.</span>methods
  <span class="token keyword">let</span> i <span class="token operator">=</span> keys<span class="token punctuation">.</span>length
  <span class="token comment">// data&#x3001;props&#x3001;methods&#x91CC;&#x7684;&#x6240;&#x6709;&#x5C5E;&#x6027;&#x90FD;&#x5C06;&#x76F4;&#x63A5;&#x6302;&#x8F7D;&#x5230;vm&#x4E0A;&#xFF0C;&#x4E0D;&#x80FD;&#x540C;&#x540D;</span>
  <span class="token keyword">while</span> <span class="token punctuation">(</span>i<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> key <span class="token operator">=</span> keys<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">!==</span> <span class="token string">&apos;production&apos;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>methods <span class="token operator">&amp;&amp;</span> <span class="token function">hasOwn</span><span class="token punctuation">(</span>methods<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">warn</span><span class="token punctuation">(</span>
          <span class="token template-string"><span class="token string">`Method &quot;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>key<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&quot; has already been defined as a data property.`</span></span><span class="token punctuation">,</span>
          vm
        <span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>props <span class="token operator">&amp;&amp;</span> <span class="token function">hasOwn</span><span class="token punctuation">(</span>props<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">!==</span> <span class="token string">&apos;production&apos;</span> <span class="token operator">&amp;&amp;</span> <span class="token function">warn</span><span class="token punctuation">(</span>
        <span class="token template-string"><span class="token string">`The data property &quot;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>key<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&quot; is already declared as a prop. `</span></span> <span class="token operator">+</span>
        <span class="token template-string"><span class="token string">`Use prop default value instead.`</span></span><span class="token punctuation">,</span>
        vm
      <span class="token punctuation">)</span>
      <span class="token comment">// IsReserved&#xFF0C;&#x4EE5; _ &#x6216; $ &#x5F00;&#x5934;&#x7684;&#x5C5E;&#x6027; &#x4E0D;&#x4F1A; &#x88AB; Vue &#x5B9E;&#x4F8B;&#x4EE3;&#x7406;&#xFF0C;&#x56E0;&#x4E3A;&#x5B83;&#x4EEC;&#x53EF;&#x80FD;&#x548C; Vue &#x5185;&#x7F6E;&#x7684;&#x5C5E;&#x6027;&#x3001;API &#x65B9;&#x6CD5;&#x51B2;&#x7A81;&#x3002;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">isReserved</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">proxy</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> <span class="token template-string"><span class="token string">`_data`</span></span><span class="token punctuation">,</span> key<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// observe data</span>
  <span class="token function">observe</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> <span class="token boolean">true</span> <span class="token comment">/* asRootData */</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</pre><p>data &#x7684;&#x521D;&#x59CB;&#x5316;&#x4E3B;&#x8981;&#x8FC7;&#x7A0B;&#x4E5F;&#x662F;&#x505A;&#x4E24;&#x4EF6;&#x4E8B;&#xFF0C;&#x2F00;&#x4E2A;&#x662F;&#x5BF9;&#x5B9A;&#x4E49; data &#x51FD;&#x6570;&#x8FD4;&#x56DE;&#x5BF9;&#x8C61;&#x7684;&#x904D;&#x5386;&#xFF0C;&#x901A;&#x8FC7; proxy&#x628A;&#x6BCF;&#x2F00;&#x4E2A;&#x503C; vm._data.xxx &#x90FD;&#x4EE3;&#x7406;&#x5230; <a href="http://vm.xxx">vm.xxx</a> &#x4E0A;&#xFF1B;&#x53E6;&#x2F00;&#x4E2A;&#x662F;&#x8C03;&#x2F64; observe &#x2F45;&#x6CD5;&#x89C2;&#x6D4B;&#x6574;&#x4E2A; data&#x7684;&#x53D8;&#x5316;&#xFF0C;&#x628A; data &#x4E5F;&#x53D8;&#x6210;&#x54CD;&#x5E94;&#x5F0F;&#xFF0C;&#x53EF;&#x4EE5;&#x901A;&#x8FC7; vm._data.xxx &#x8BBF;&#x95EE;&#x5230;&#x5B9A;&#x4E49; data &#x8FD4;&#x56DE;&#x51FD;&#x6570;&#x4E2D;&#x5BF9;&#x5E94;&#x7684;&#x5C5E;&#x6027;&#xFF0C; observe &#x6211;&#x4EEC;&#x7A0D;&#x540E;&#x518D;&#x770B;&#x3002;</p>
<h2 class="mume-header" id="proxy">proxy</h2>

<p>proxy&#x7684;&#x4F5C;&#x2F64;&#x662F;&#x628A; props &#x548C; data &#x4E0A;&#x7684;&#x5C5E;&#x6027;&#x4EE3;&#x7406;&#x5230; vm &#x5B9E;&#x4F8B;&#x4E0A;&#xFF0C;&#x8FD9;&#x4E5F;&#x5C31;&#x662F;&#x4E3A;&#x4EC0;&#x4E48;&#x2F50;&#x5982;&#x6211;&#x4EEC;&#x5B9A;&#x4E49;&#x4E86;&#x5982;&#x4E0B; props&#xFF0C;&#x5374;&#x53EF;&#x4EE5;&#x901A;&#x8FC7; vm &#x5B9E;&#x4F8B;&#x8BBF;&#x95EE;&#x5230;&#x5B83;&#x3002;</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token operator">...</span>
<span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
        msg<span class="token punctuation">:</span> <span class="token string">&apos;hello&apos;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token operator">...</span>
methods<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token function">getMsg</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>msg<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</pre><p>&#x770B;&#x4E00;&#x4E0B;proxy&#x65B9;&#x6CD5;</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token keyword">const</span> sharedPropertyDefinition <span class="token operator">=</span> <span class="token punctuation">{</span>
  enumerable<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  configurable<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token keyword">get</span><span class="token punctuation">:</span> noop<span class="token punctuation">,</span> 
  <span class="token keyword">set</span><span class="token punctuation">:</span> noop
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">proxy</span> <span class="token punctuation">(</span>target<span class="token punctuation">:</span> Object<span class="token punctuation">,</span> sourceKey<span class="token punctuation">:</span> string<span class="token punctuation">,</span> key<span class="token punctuation">:</span> string<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  sharedPropertyDefinition<span class="token punctuation">.</span><span class="token function-variable function">get</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">proxyGetter</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">[</span>sourceKey<span class="token punctuation">]</span><span class="token punctuation">[</span>key<span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
  sharedPropertyDefinition<span class="token punctuation">.</span><span class="token function-variable function">set</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">proxySetter</span> <span class="token punctuation">(</span>val<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">[</span>sourceKey<span class="token punctuation">]</span><span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> val
  <span class="token punctuation">}</span>
  Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> key<span class="token punctuation">,</span> sharedPropertyDefinition<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</pre><p>proxy &#x901A;&#x8FC7; <code>Object.defineProperty</code> &#x628A; <code>target[sourceKey][key]</code> &#x7684;&#x8BFB;&#x5199;&#x53D8;&#x6210;&#x4E86;&#x5BF9; <code>target[key]</code> &#x7684;&#x8BFB;&#x5199;&#x3002;&#x6240;&#x4EE5;&#x5BF9;&#x4E8E; props &#x2F7D;&#x2F94;&#xFF0C;&#x5BF9; <code>vm._props.xxx</code> &#x7684;&#x8BFB;&#x5199;&#x53D8;&#x6210;&#x4E86;<code>vm.xxx</code> &#x7684;&#x8BFB;&#x5199;&#xFF0C;&#x2F7D;&#x5BF9;&#x4E8E; <code>vm._props.xxx</code> ,&#x6211;&#x4EEC;&#x5C06;&#x5230;&#x5B9A;&#x4E49;&#x5728; props &#x4E2D;&#x7684;&#x5C5E;&#x6027;&#x7F13;&#x5B58;&#x5230;<code>vm._props</code>&#x4E2D;&#xFF0C;&#x6240;&#x4EE5;&#x6211;&#x4EEC;&#x5C31;&#x53EF;&#x4EE5;&#x901A;&#x8FC7; <a href="http://vm.xxx">vm.xxx</a> &#x8BBF;&#x95EE;&#x5230;&#x5B9A;&#x4E49;&#x5728; props &#x4E2D;&#x7684; xxx &#x5C5E;&#x6027;&#x4E86;&#x3002;&#x5176;&#x4F59;&#x540C;&#x7406;&#x3002;</p>
<h2 class="mume-header" id="observe">observe</h2>

<p>observe &#x7684;&#x529F;&#x80FD;&#x5C31;&#x662F;&#x2F64;&#x6765;&#x76D1;&#x6D4B;&#x6570;&#x636E;&#x7684;&#x53D8;&#x5316;</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token comment">/**
 * Attempt to create an observer instance for a value,
 * returns the new observer if successfully observed,
 * or the existing observer if the value already has one.
 */</span>
<span class="token comment">// asRootData&#x5224;&#x65AD;&#x662F;&#x5426;&#x662F;&#x6839;&#x6570;&#x636E;</span>
<span class="token comment">// initData&#x4E2D;observe(data, true /* asRootData */)</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">observe</span> <span class="token punctuation">(</span>value<span class="token punctuation">:</span> any<span class="token punctuation">,</span> asRootData<span class="token punctuation">:</span> <span class="token operator">?</span>boolean<span class="token punctuation">)</span><span class="token punctuation">:</span> Observer <span class="token operator">|</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">isObject</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token operator">||</span> value <span class="token keyword">instanceof</span> <span class="token class-name">VNode</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">let</span> ob<span class="token punctuation">:</span> Observer <span class="token operator">|</span> <span class="token keyword">void</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">hasOwn</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span> <span class="token string">&apos;__ob__&apos;</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> value<span class="token punctuation">.</span>__ob__ <span class="token keyword">instanceof</span> <span class="token class-name">Observer</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    ob <span class="token operator">=</span> value<span class="token punctuation">.</span>__ob__
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>
    shouldObserve <span class="token operator">&amp;&amp;</span>  
    <span class="token operator">!</span><span class="token function">isServerRendering</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>
    <span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token function">isPlainObject</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>
    Object<span class="token punctuation">.</span><span class="token function">isExtensible</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>
    <span class="token operator">!</span>value<span class="token punctuation">.</span>_isVue
  <span class="token punctuation">)</span> <span class="token punctuation">{</span>
    ob <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Observer</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>asRootData <span class="token operator">&amp;&amp;</span> ob<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    ob<span class="token punctuation">.</span>vmCount<span class="token operator">++</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> ob
<span class="token punctuation">}</span>
</pre><p>observe &#x2F45;&#x6CD5;&#x7684;&#x4F5C;&#x2F64;&#x5C31;&#x662F;&#x7ED9;&#x2FAE; VNode &#x7684;&#x5BF9;&#x8C61;&#x7C7B;&#x578B;&#x6570;&#x636E;&#x6DFB;&#x52A0;&#x2F00;&#x4E2A; Observer &#xFF0C;&#x5982;&#x679C;&#x5DF2;&#x7ECF;&#x6DFB;&#x52A0;&#x8FC7;&#x5219;&#x76F4;&#x63A5;&#x8FD4;&#x56DE;&#xFF0C;&#x5426;&#x5219;&#x5728;&#x6EE1;&#x2F9C;&#x2F00;&#x5B9A;&#x6761;&#x4EF6;&#x4E0B;&#x53BB;&#x5B9E;&#x4F8B;&#x5316;&#x2F00;&#x4E2A; Observer &#x5BF9;&#x8C61;&#x5B9E;&#x4F8B;&#x3002;</p>
<h2 class="mume-header" id="observer">Observer</h2>

<p>Observer &#x662F;&#x2F00;&#x4E2A;&#x7C7B;&#xFF0C;&#x5B83;&#x7684;&#x4F5C;&#x2F64;&#x662F;&#x7ED9;&#x5BF9;&#x8C61;&#x7684;&#x5C5E;&#x6027;&#x6DFB;&#x52A0; getter &#x548C; setter&#xFF0C;&#x2F64;&#x4E8E;&#x4F9D;&#x8D56;&#x6536;&#x96C6;&#x548C;&#x6D3E;&#x53D1;&#x66F4;&#x65B0;</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token comment">/**
 * Observer class that is attached to each observed
 * object. Once attached, the observer converts the target
 * object&apos;s property keys into getter/setters that
 * collect dependencies and dispatch updates.
 */</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">Observer</span> <span class="token punctuation">{</span>
  value<span class="token punctuation">:</span> any<span class="token punctuation">;</span>
  dep<span class="token punctuation">:</span> Dep<span class="token punctuation">;</span>
  vmCount<span class="token punctuation">:</span> number<span class="token punctuation">;</span> <span class="token comment">// number of vms that has this object as root $data</span>

  <span class="token function">constructor</span> <span class="token punctuation">(</span>value<span class="token punctuation">:</span> any<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>value <span class="token operator">=</span> value
    <span class="token keyword">this</span><span class="token punctuation">.</span>dep <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Dep</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>vmCount <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token function">def</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span> <span class="token string">&apos;__ob__&apos;</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> augment <span class="token operator">=</span> hasProto
        <span class="token operator">?</span> protoAugment
        <span class="token punctuation">:</span> copyAugment
      <span class="token function">augment</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span> arrayMethods<span class="token punctuation">,</span> arrayKeys<span class="token punctuation">)</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">observeArray</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">walk</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token comment">/**
   * Walk through each property and convert them into
   * getter/setters. This method should only be called when
   * value type is Object.
   */</span>
  <span class="token function">walk</span> <span class="token punctuation">(</span>obj<span class="token punctuation">:</span> Object<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> keys <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> keys<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">defineReactive</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> keys<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token comment">/**
   * Observe a list of Array items.
   */</span>
  <span class="token function">observeArray</span> <span class="token punctuation">(</span>items<span class="token punctuation">:</span> Array<span class="token operator">&lt;</span>any<span class="token operator">&gt;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> l <span class="token operator">=</span> items<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> l<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">observe</span><span class="token punctuation">(</span>items<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</pre><p>Observer &#x7684;&#x6784;&#x9020;&#x51FD;&#x6570;&#x903B;&#x8F91;&#x5F88;&#x7B80;&#x5355;&#xFF0C;&#x2FB8;&#x5148;&#x5B9E;&#x4F8B;&#x5316; Dep &#x5BF9;&#x8C61;&#xFF0C;&#x8FD9;&#x5757;&#x7A0D;&#x540E;&#x4F1A;&#x4ECB;&#x7ECD;&#xFF0C;&#x63A5;&#x7740;&#x901A;&#x8FC7;&#x6267;&#x2F8F; def&#x51FD;&#x6570;&#x628A;&#x2F83;&#x2F9D;&#x5B9E;&#x4F8B;&#x6DFB;&#x52A0;&#x5230;&#x6570;&#x636E;&#x5BF9;&#x8C61; value &#x7684; <code>__ob__</code>&#x5C5E;&#x6027;&#x4E0A;&#xFF0C;&#x6211;&#x4EEC;&#x770B;&#x4E00;&#x4E0B;def&#x51FD;&#x6570;&#x3002;</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token comment">/**
 * Define a property.
 */</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">def</span> <span class="token punctuation">(</span>obj<span class="token punctuation">:</span> Object<span class="token punctuation">,</span> key<span class="token punctuation">:</span> string<span class="token punctuation">,</span> val<span class="token punctuation">:</span> any<span class="token punctuation">,</span> enumerable<span class="token operator">?</span><span class="token punctuation">:</span> boolean<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> key<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    value<span class="token punctuation">:</span> val<span class="token punctuation">,</span>
    enumerable<span class="token punctuation">:</span> <span class="token operator">!</span><span class="token operator">!</span>enumerable<span class="token punctuation">,</span>
    writable<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    configurable<span class="token punctuation">:</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</pre><p>def &#x51FD;&#x6570;&#x662F;&#x2F00;&#x4E2A;&#x2FAE;&#x5E38;&#x7B80;&#x5355;&#x7684; Object.defineProperty &#x7684;&#x5C01;&#x88C5;&#xFF0C;&#x8FD9;&#x5C31;&#x662F;&#x4E3A;&#x4EC0;&#x4E48;&#x6211;&#x5728;&#x5F00;&#x53D1;&#x4E2D;&#x8F93;&#x51FA;data &#x4E0A;&#x5BF9;&#x8C61;&#x7C7B;&#x578B;&#x7684;&#x6570;&#x636E;&#xFF0C;&#x4F1A;&#x53D1;&#x73B0;&#x8BE5;&#x5BF9;&#x8C61;&#x591A;&#x4E86;&#x2F00;&#x4E2A; <code>__ob__</code> &#x7684;&#x5C5E;&#x6027;,&#x5982;&#x4E0B;&#x56FE;:<br>
<img src="1.png" alt="avatar"></p>
<h2 class="mume-header" id="definereactive">defineReactive</h2>

<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token comment">/**
 * Define a reactive property on an Object.
 */</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">defineReactive</span> <span class="token punctuation">(</span>
  obj<span class="token punctuation">:</span> Object<span class="token punctuation">,</span>
  key<span class="token punctuation">:</span> string<span class="token punctuation">,</span>
  val<span class="token punctuation">:</span> any<span class="token punctuation">,</span>
  customSetter<span class="token operator">?</span><span class="token punctuation">:</span> <span class="token operator">?</span>Function<span class="token punctuation">,</span>
  shallow<span class="token operator">?</span><span class="token punctuation">:</span> boolean
<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> dep <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Dep</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

  <span class="token keyword">const</span> property <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">getOwnPropertyDescriptor</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> key<span class="token punctuation">)</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>property <span class="token operator">&amp;&amp;</span> property<span class="token punctuation">.</span>configurable <span class="token operator">===</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// cater for pre-defined getter/setters</span>
  <span class="token keyword">const</span> getter <span class="token operator">=</span> property <span class="token operator">&amp;&amp;</span> property<span class="token punctuation">.</span><span class="token keyword">get</span>
  <span class="token keyword">const</span> setter <span class="token operator">=</span> property <span class="token operator">&amp;&amp;</span> property<span class="token punctuation">.</span><span class="token keyword">set</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">!</span>getter <span class="token operator">||</span> setter<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> arguments<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    val <span class="token operator">=</span> obj<span class="token punctuation">[</span>key<span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// &#x9012;&#x5F52;&#x8C03;&#x7528;observe&#xFF0C;&#x67D0;&#x4E2A;&#x5BF9;&#x8C61;&#x7684;&#x5C5E;&#x6027;&#x503C;&#x662F;&#x5BF9;&#x8C61;&#x65F6;&#xFF0C;&#x4F1A;&#x9012;&#x5F52;&#x8C03;&#x7528;observe</span>
  <span class="token keyword">let</span> childOb <span class="token operator">=</span> <span class="token operator">!</span>shallow <span class="token operator">&amp;&amp;</span> <span class="token function">observe</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span>
  Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> key<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    enumerable<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    configurable<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token keyword">get</span><span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token function">reactiveGetter</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> value <span class="token operator">=</span> getter <span class="token operator">?</span> getter<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span> <span class="token punctuation">:</span> val
      <span class="token keyword">if</span> <span class="token punctuation">(</span>Dep<span class="token punctuation">.</span>target<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        dep<span class="token punctuation">.</span><span class="token function">depend</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>childOb<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          childOb<span class="token punctuation">.</span>dep<span class="token punctuation">.</span><span class="token function">depend</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">dependArray</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">return</span> value
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token keyword">set</span><span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token function">reactiveSetter</span> <span class="token punctuation">(</span>newVal<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> value <span class="token operator">=</span> getter <span class="token operator">?</span> getter<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span> <span class="token punctuation">:</span> val
      <span class="token comment">/* eslint-disable no-self-compare */</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>newVal <span class="token operator">===</span> value <span class="token operator">||</span> <span class="token punctuation">(</span>newVal <span class="token operator">!==</span> newVal <span class="token operator">&amp;&amp;</span> value <span class="token operator">!==</span> value<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span>
      <span class="token punctuation">}</span>
      <span class="token comment">/* eslint-enable no-self-compare */</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">!==</span> <span class="token string">&apos;production&apos;</span> <span class="token operator">&amp;&amp;</span> customSetter<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">customSetter</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>setter<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        setter<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> newVal<span class="token punctuation">)</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        val <span class="token operator">=</span> newVal
      <span class="token punctuation">}</span>
      childOb <span class="token operator">=</span> <span class="token operator">!</span>shallow <span class="token operator">&amp;&amp;</span> <span class="token function">observe</span><span class="token punctuation">(</span>newVal<span class="token punctuation">)</span>
      dep<span class="token punctuation">.</span><span class="token function">notify</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</pre><p>defineReactive &#x51FD;&#x6570;&#x6700;&#x5F00;&#x59CB;&#x521D;&#x59CB;&#x5316; Dep &#x5BF9;&#x8C61;&#x7684;&#x5B9E;&#x4F8B;&#xFF0C;&#x63A5;&#x7740;&#x62FF;&#x5230; obj &#x7684;&#x5C5E;&#x6027;&#x63CF;&#x8FF0;&#x7B26;&#xFF0C;&#x7136;&#x540E;&#x5BF9;&#x2F26;&#x5BF9;&#x8C61;&#x9012;&#x5F52;&#x8C03;&#x2F64; observe &#x2F45;&#x6CD5;&#xFF0C;&#x8FD9;&#x6837;&#x5C31;&#x4FDD;&#x8BC1;&#x4E86;&#x2F46;&#x8BBA; obj &#x7684;&#x7ED3;&#x6784;&#x591A;&#x590D;&#x6742;&#xFF0C;&#x5B83;&#x7684;&#x6240;&#x6709;&#x2F26;&#x5C5E;&#x6027;&#x4E5F;&#x80FD;&#x53D8;&#x6210;&#x54CD;&#x5E94;&#x5F0F;&#x7684;&#x5BF9;&#x8C61;&#xFF0C;&#x8FD9;&#x6837;&#x6211;&#x4EEC;&#x8BBF;&#x95EE;&#x6216;&#x4FEE;&#x6539; obj &#x4E2D;&#x2F00;&#x4E2A;&#x5D4C;&#x5957;&#x8F83;&#x6DF1;&#x7684;&#x5C5E;&#x6027;&#xFF0C;&#x4E5F;&#x80FD;&#x89E6;&#x53D1; getter &#x548C; setter&#x3002;&#x6700;&#x540E;&#x5229;&#x2F64;Object.defineProperty &#x53BB;&#x7ED9; obj &#x7684;&#x5C5E;&#x6027; key &#x6DFB;&#x52A0; getter &#x548C; setter&#x3002;</p>
<h2 class="mume-header" id="%E4%BE%9D%E8%B5%96%E6%94%B6%E9%9B%86">&#x4F9D;&#x8D56;&#x6536;&#x96C6;</h2>

<p>1.const dep = new Dep() &#x5B9E;&#x4F8B;&#x5316;&#x2F00;&#x4E2A; Dep &#x7684;&#x5B9E;&#x4F8B;<br>
2.dep.depend<br>
3.childObj &#x5224;&#x65AD;&#x7684;&#x903B;&#x8F91;(&#x7ED9;Vue.set&#x65B9;&#x6CD5;&#x4F7F;&#x7528;)</p>
<h2 class="mume-header" id="dep">Dep</h2>

<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token keyword">import</span> type Watcher <span class="token keyword">from</span> <span class="token string">&apos;./watcher&apos;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> remove <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&apos;../util/index&apos;</span>
<span class="token keyword">import</span> config <span class="token keyword">from</span> <span class="token string">&apos;../config&apos;</span>

<span class="token keyword">let</span> uid <span class="token operator">=</span> <span class="token number">0</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Dep</span> <span class="token punctuation">{</span>
  <span class="token keyword">static</span> target<span class="token punctuation">:</span> <span class="token operator">?</span>Watcher<span class="token punctuation">;</span>
  id<span class="token punctuation">:</span> number<span class="token punctuation">;</span>
  subs<span class="token punctuation">:</span> Array<span class="token operator">&lt;</span>Watcher<span class="token operator">&gt;</span><span class="token punctuation">;</span>

  <span class="token function">constructor</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>id <span class="token operator">=</span> uid<span class="token operator">++</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>subs <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span>

  <span class="token function">addSub</span> <span class="token punctuation">(</span>sub<span class="token punctuation">:</span> Watcher<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>subs<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>sub<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token function">removeSub</span> <span class="token punctuation">(</span>sub<span class="token punctuation">:</span> Watcher<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">remove</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>subs<span class="token punctuation">,</span> sub<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token function">depend</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>Dep<span class="token punctuation">.</span>target<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      Dep<span class="token punctuation">.</span>target<span class="token punctuation">.</span><span class="token function">addDep</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token function">notify</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// stabilize the subscriber list first</span>
    <span class="token keyword">const</span> subs <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>subs<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">!==</span> <span class="token string">&apos;production&apos;</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>config<span class="token punctuation">.</span><span class="token keyword">async</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// subs aren&apos;t sorted in scheduler if not running async</span>
      <span class="token comment">// we need to sort them now to make sure they fire in correct</span>
      <span class="token comment">// order</span>
      subs<span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> a<span class="token punctuation">.</span>id <span class="token operator">-</span> b<span class="token punctuation">.</span>id<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> l <span class="token operator">=</span> subs<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> l<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      subs<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// the current target watcher being evaluated.</span>
<span class="token comment">// this is globally unique because there could be only one</span>
<span class="token comment">// watcher being evaluated at any time.</span>
Dep<span class="token punctuation">.</span>target <span class="token operator">=</span> <span class="token keyword">null</span>
<span class="token keyword">const</span> targetStack <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>

<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">pushTarget</span> <span class="token punctuation">(</span>_target<span class="token punctuation">:</span> <span class="token operator">?</span>Watcher<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>Dep<span class="token punctuation">.</span>target<span class="token punctuation">)</span> targetStack<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>Dep<span class="token punctuation">.</span>target<span class="token punctuation">)</span>
  Dep<span class="token punctuation">.</span>target <span class="token operator">=</span> _target
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">popTarget</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  Dep<span class="token punctuation">.</span>target <span class="token operator">=</span> targetStack<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

</pre><p>1.&#x5B83;&#x6709;&#x2F00;&#x4E2A;&#x9759;&#x6001;&#x5C5E;&#x6027; target &#xFF0C;&#x8FD9;&#x662F;&#x2F00;&#x4E2A;&#x5168;&#x5C40;&#x552F;&#x2F00;Watcher&#xFF0C;&#x56E0;&#x4E3A;&#x5728;&#x540C;&#x2F00;&#x65F6;&#x95F4;&#x53EA;&#x80FD;&#x6709;&#x2F00;&#x4E2A;&#x5168;&#x5C40;&#x7684;Watcher  &#x88AB;&#x8BA1;&#x7B97;&#x3002;<br>
2.subs&#x662F;&#x5B58;&#x50A8;Watcher&#x7684;&#x6570;&#x7EC4;&#x3002;<br>
Dep&#x5176;&#x5B9E;&#x5C31;&#x662F;&#x4E3A;&#x4E86;&#x7BA1;&#x7406;Watcher</p>
<h2 class="mume-header" id="watcher">Watcher</h2>

<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token keyword">import</span> <span class="token punctuation">{</span>
  warn<span class="token punctuation">,</span>
  remove<span class="token punctuation">,</span>
  isObject<span class="token punctuation">,</span>
  parsePath<span class="token punctuation">,</span>
  _Set <span class="token keyword">as</span> Set<span class="token punctuation">,</span>
  handleError
<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&apos;../util/index&apos;</span>

<span class="token keyword">import</span> <span class="token punctuation">{</span> traverse <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&apos;./traverse&apos;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> queueWatcher <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&apos;./scheduler&apos;</span>
<span class="token keyword">import</span> Dep<span class="token punctuation">,</span> <span class="token punctuation">{</span> pushTarget<span class="token punctuation">,</span> popTarget <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&apos;./dep&apos;</span>

<span class="token keyword">import</span> type <span class="token punctuation">{</span> SimpleSet <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&apos;../util/index&apos;</span>

<span class="token keyword">let</span> uid <span class="token operator">=</span> <span class="token number">0</span>

<span class="token comment">/**
 * A watcher parses an expression, collects dependencies,
 * and fires callback when the expression value changes.
 * This is used for both the $watch() api and directives.
 */</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Watcher</span> <span class="token punctuation">{</span>
  vm<span class="token punctuation">:</span> Component<span class="token punctuation">;</span>
  expression<span class="token punctuation">:</span> string<span class="token punctuation">;</span>
  cb<span class="token punctuation">:</span> Function<span class="token punctuation">;</span>
  id<span class="token punctuation">:</span> number<span class="token punctuation">;</span>
  deep<span class="token punctuation">:</span> boolean<span class="token punctuation">;</span>
  user<span class="token punctuation">:</span> boolean<span class="token punctuation">;</span>
  lazy<span class="token punctuation">:</span> boolean<span class="token punctuation">;</span>
  sync<span class="token punctuation">:</span> boolean<span class="token punctuation">;</span>
  dirty<span class="token punctuation">:</span> boolean<span class="token punctuation">;</span>
  active<span class="token punctuation">:</span> boolean<span class="token punctuation">;</span>
  deps<span class="token punctuation">:</span> Array<span class="token operator">&lt;</span>Dep<span class="token operator">&gt;</span><span class="token punctuation">;</span>
  newDeps<span class="token punctuation">:</span> Array<span class="token operator">&lt;</span>Dep<span class="token operator">&gt;</span><span class="token punctuation">;</span>
  depIds<span class="token punctuation">:</span> SimpleSet<span class="token punctuation">;</span>
  newDepIds<span class="token punctuation">:</span> SimpleSet<span class="token punctuation">;</span>
  before<span class="token punctuation">:</span> <span class="token operator">?</span>Function<span class="token punctuation">;</span>
  getter<span class="token punctuation">:</span> Function<span class="token punctuation">;</span>
  value<span class="token punctuation">:</span> any<span class="token punctuation">;</span>

  <span class="token function">constructor</span> <span class="token punctuation">(</span>
    vm<span class="token punctuation">:</span> Component<span class="token punctuation">,</span>
    expOrFn<span class="token punctuation">:</span> string <span class="token operator">|</span> Function<span class="token punctuation">,</span>
    cb<span class="token punctuation">:</span> Function<span class="token punctuation">,</span>
    options<span class="token operator">?</span><span class="token punctuation">:</span> <span class="token operator">?</span>Object<span class="token punctuation">,</span>
    isRenderWatcher<span class="token operator">?</span><span class="token punctuation">:</span> boolean
  <span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>vm <span class="token operator">=</span> vm
    <span class="token keyword">if</span> <span class="token punctuation">(</span>isRenderWatcher<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      vm<span class="token punctuation">.</span>_watcher <span class="token operator">=</span> <span class="token keyword">this</span>
    <span class="token punctuation">}</span>
    vm<span class="token punctuation">.</span>_watchers<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>
    <span class="token comment">// options</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>options<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>deep <span class="token operator">=</span> <span class="token operator">!</span><span class="token operator">!</span>options<span class="token punctuation">.</span>deep
      <span class="token keyword">this</span><span class="token punctuation">.</span>user <span class="token operator">=</span> <span class="token operator">!</span><span class="token operator">!</span>options<span class="token punctuation">.</span>user
      <span class="token keyword">this</span><span class="token punctuation">.</span>lazy <span class="token operator">=</span> <span class="token operator">!</span><span class="token operator">!</span>options<span class="token punctuation">.</span>lazy
      <span class="token keyword">this</span><span class="token punctuation">.</span>sync <span class="token operator">=</span> <span class="token operator">!</span><span class="token operator">!</span>options<span class="token punctuation">.</span>sync
      <span class="token keyword">this</span><span class="token punctuation">.</span>before <span class="token operator">=</span> options<span class="token punctuation">.</span>before
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>deep <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>user <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>lazy <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>sync <span class="token operator">=</span> <span class="token boolean">false</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>cb <span class="token operator">=</span> cb
    <span class="token keyword">this</span><span class="token punctuation">.</span>id <span class="token operator">=</span> <span class="token operator">++</span>uid <span class="token comment">// uid for batching</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>active <span class="token operator">=</span> <span class="token boolean">true</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>dirty <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>lazy <span class="token comment">// for lazy watchers</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>deps <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>newDeps <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>depIds <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>newDepIds <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>expression <span class="token operator">=</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">!==</span> <span class="token string">&apos;production&apos;</span>
      <span class="token operator">?</span> expOrFn<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">:</span> <span class="token string">&apos;&apos;</span>
    <span class="token comment">// parse expression for getter</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> expOrFn <span class="token operator">===</span> <span class="token string">&apos;function&apos;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>getter <span class="token operator">=</span> expOrFn
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>getter <span class="token operator">=</span> <span class="token function">parsePath</span><span class="token punctuation">(</span>expOrFn<span class="token punctuation">)</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>getter<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function-variable function">getter</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
        process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">!==</span> <span class="token string">&apos;production&apos;</span> <span class="token operator">&amp;&amp;</span> <span class="token function">warn</span><span class="token punctuation">(</span>
          <span class="token template-string"><span class="token string">`Failed watching path: &quot;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>expOrFn<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&quot; `</span></span> <span class="token operator">+</span>
          <span class="token string">&apos;Watcher only accepts simple dot-delimited paths. &apos;</span> <span class="token operator">+</span>
          <span class="token string">&apos;For full control, use a function instead.&apos;</span><span class="token punctuation">,</span>
          vm
        <span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>lazy
      <span class="token operator">?</span> undefined
      <span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token comment">/**
   * Evaluate the getter, and re-collect dependencies.
   */</span>
  <span class="token keyword">get</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">pushTarget</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>
    <span class="token keyword">let</span> value
    <span class="token keyword">const</span> vm <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>vm
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
      value <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>getter<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> vm<span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>user<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">handleError</span><span class="token punctuation">(</span>e<span class="token punctuation">,</span> vm<span class="token punctuation">,</span> <span class="token template-string"><span class="token string">`getter for watcher &quot;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>expression<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&quot;`</span></span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token keyword">throw</span> e
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
      <span class="token comment">// &quot;touch&quot; every property so they are all tracked as</span>
      <span class="token comment">// dependencies for deep watching</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>deep<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">traverse</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
      <span class="token function">popTarget</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">cleanupDeps</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> value
  <span class="token punctuation">}</span>

  <span class="token comment">/**
   * Add a dependency to this directive.
   */</span>
  <span class="token function">addDep</span> <span class="token punctuation">(</span>dep<span class="token punctuation">:</span> Dep<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> id <span class="token operator">=</span> dep<span class="token punctuation">.</span>id
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>newDepIds<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>newDepIds<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>newDeps<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>dep<span class="token punctuation">)</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>depIds<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        dep<span class="token punctuation">.</span><span class="token function">addSub</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token comment">/**
   * Clean up for dependency collection.
   */</span>
  <span class="token function">cleanupDeps</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>deps<span class="token punctuation">.</span>length
    <span class="token keyword">while</span> <span class="token punctuation">(</span>i<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> dep <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>deps<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>newDepIds<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span>dep<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        dep<span class="token punctuation">.</span><span class="token function">removeSub</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">let</span> tmp <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>depIds
    <span class="token keyword">this</span><span class="token punctuation">.</span>depIds <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>newDepIds
    <span class="token keyword">this</span><span class="token punctuation">.</span>newDepIds <span class="token operator">=</span> tmp
    <span class="token keyword">this</span><span class="token punctuation">.</span>newDepIds<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    tmp <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>deps
    <span class="token keyword">this</span><span class="token punctuation">.</span>deps <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>newDeps
    <span class="token keyword">this</span><span class="token punctuation">.</span>newDeps <span class="token operator">=</span> tmp
    <span class="token keyword">this</span><span class="token punctuation">.</span>newDeps<span class="token punctuation">.</span>length <span class="token operator">=</span> <span class="token number">0</span>
  <span class="token punctuation">}</span>

  <span class="token comment">/**
   * Subscriber interface.
   * Will be called when a dependency changes.
   */</span>
  <span class="token function">update</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">/* istanbul ignore else */</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>lazy<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>dirty <span class="token operator">=</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>sync<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token function">queueWatcher</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token comment">/**
   * Scheduler job interface.
   * Will be called by the scheduler.
   */</span>
  <span class="token function">run</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>active<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> value <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>
        value <span class="token operator">!==</span> <span class="token keyword">this</span><span class="token punctuation">.</span>value <span class="token operator">||</span>
        <span class="token comment">// Deep watchers and watchers on Object/Arrays should fire even</span>
        <span class="token comment">// when the value is the same, because the value may</span>
        <span class="token comment">// have mutated.</span>
        <span class="token function">isObject</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token operator">||</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>deep
      <span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// set new value</span>
        <span class="token keyword">const</span> oldValue <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>value
        <span class="token keyword">this</span><span class="token punctuation">.</span>value <span class="token operator">=</span> value
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>user<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>cb<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>vm<span class="token punctuation">,</span> value<span class="token punctuation">,</span> oldValue<span class="token punctuation">)</span>
          <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">handleError</span><span class="token punctuation">(</span>e<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>vm<span class="token punctuation">,</span> <span class="token template-string"><span class="token string">`callback for watcher &quot;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>expression<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&quot;`</span></span><span class="token punctuation">)</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>cb<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>vm<span class="token punctuation">,</span> value<span class="token punctuation">,</span> oldValue<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token comment">/**
   * Evaluate the value of the watcher.
   * This only gets called for lazy watchers.
   */</span>
  <span class="token function">evaluate</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>dirty <span class="token operator">=</span> <span class="token boolean">false</span>
  <span class="token punctuation">}</span>

  <span class="token comment">/**
   * Depend on all deps collected by this watcher.
   */</span>
  <span class="token function">depend</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>deps<span class="token punctuation">.</span>length
    <span class="token keyword">while</span> <span class="token punctuation">(</span>i<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>deps<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">depend</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token comment">/**
   * Remove self from all dependencies&apos; subscriber list.
   */</span>
  <span class="token function">teardown</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>active<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// remove self from vm&apos;s watcher list</span>
      <span class="token comment">// this is a somewhat expensive operation so we skip it</span>
      <span class="token comment">// if the vm is being destroyed.</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>vm<span class="token punctuation">.</span>_isBeingDestroyed<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">remove</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>vm<span class="token punctuation">.</span>_watchers<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>deps<span class="token punctuation">.</span>length
      <span class="token keyword">while</span> <span class="token punctuation">(</span>i<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>deps<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">removeSub</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>active <span class="token operator">=</span> <span class="token boolean">false</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</pre><p>&#x5B9A;&#x4E49;&#x4E86;&#x4E00;&#x4E9B;&#x548C;Dep&#x76F8;&#x5173;&#x7684;&#x5C5E;&#x6027;</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token keyword">this</span><span class="token punctuation">.</span>deps <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>newDeps <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>depIds <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>newDepIds <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</pre><p>this.deps  &#x548C;  this.newDeps  &#x8868;&#x2F70;  Watcher  &#x5B9E;&#x4F8B;&#x6301;&#x6709;&#x7684;  Dep  &#x5B9E;&#x4F8B;&#x7684;&#x6570;&#x7EC4;&#xFF1B;&#x2F7D;this.depIds  &#x548C;  this.newDepIds  &#x5206;&#x522B;&#x4EE3;&#x8868;  this.deps  &#x548C;  this.newDeps  &#x7684;  id  Set&#xFF08;&#x8FD9;&#x4E2A;Set &#x662F; ES6 &#x7684;&#x6570;&#x636E;&#x7ED3;&#x6784;&#xFF0C;&#x5B83;&#x7684;&#x5B9E;&#x73B0;&#x5728;  src/core/util/env.js  &#x4E2D;&#xFF09;&#x3002;&#x90A3;&#x4E48;&#x8FD9;&#x2FA5;&#x4E3A;&#x4F55;&#x9700;&#x8981;&#x6709; 2 &#x4E2A;  Dep&#x5B9E;&#x4F8B;&#x6570;&#x7EC4;&#x5462;&#xFF0C;&#x7A0D;&#x540E;&#x6211;&#x4EEC;&#x4F1A;&#x89E3;&#x91CA;&#x3002;<br>
Watcher  &#x8FD8;&#x5B9A;&#x4E49;&#x4E86;&#x2F00;&#x4E9B;&#x539F;&#x578B;&#x7684;&#x2F45;&#x6CD5;&#xFF0C;&#x548C;&#x4F9D;&#x8D56;&#x6536;&#x96C6;&#x76F8;&#x5173;&#x7684;&#x6709;  get  &#x3001; addDep  &#x548C;  cleanupDeps &#x2F45;&#x6CD5;&#x3002;<br>
&#x63A5;&#x4E0B;&#x6765;&#x4F1A;&#x4ECE;&#x6574;&#x4E2A;&#x4F9D;&#x8D56;&#x6536;&#x96C6;&#x8FC7;&#x7A0B;&#x4E2D;&#x9010;&#x6B65;&#x5206;&#x6790;&#x8FD9;&#x4E9B;&#x65B9;&#x6CD5;&#x3002;<br>
&#x5728;mounted&#x7684;&#x8FC7;&#x7A0B;&#x4E2D;,&#x6709;&#x8FD9;&#x4E48;&#x4E00;&#x6BB5;&#x8BDD;&#xFF1A;</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token function-variable function">updateComponent</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  vm<span class="token punctuation">.</span><span class="token function">_update</span><span class="token punctuation">(</span>vm<span class="token punctuation">.</span><span class="token function">_render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> hydrating<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">new</span> <span class="token class-name">Watcher</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> updateComponent<span class="token punctuation">,</span> noop<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token function">before</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>vm<span class="token punctuation">.</span>_isMounted<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">callHook</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> <span class="token string">&apos;beforeUpdate&apos;</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">true</span> <span class="token comment">/* isRenderWatcher */</span><span class="token punctuation">)</span>
</pre><p>&#x56DE;&#x987E;&#x4E00;&#x4E0B;&#x5B9E;&#x4F8B;&#x5316;&#x6E32;&#x67D3;watcher&#x7684;&#x8FC7;&#x7A0B;<br>
&#x6784;&#x9020;&#x51FD;&#x6570;&#x4E2D;&#x6709;2&#x4E2A;&#x6BD4;&#x8F83;&#x91CD;&#x8981;&#x7684;&#x70B9;&#xFF1A;</p>
<ol>
<li><code>vm._watchers.push(this)</code></li>
<li><code>this.get()</code></li>
</ol>
<h3 class="mume-header" id="get">get()</h3>

<ol>
<li><code>pushTarget(this)</code><br>
&#x5B9A;&#x4E49;&#x5728;Dep&#x4E2D;</li>
</ol>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">pushTarget</span> <span class="token punctuation">(</span>_target<span class="token punctuation">:</span> Watcher<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>Dep<span class="token punctuation">.</span>target<span class="token punctuation">)</span> targetStack<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>Dep<span class="token punctuation">.</span>target<span class="token punctuation">)</span>
    Dep<span class="token punctuation">.</span>target <span class="token operator">=</span> _target
<span class="token punctuation">}</span>
</pre><p>&#x5B9E;&#x9645;&#x4E0A;&#x5C31;&#x662F;&#x628A;  Dep.target  &#x8D4B;&#x503C;&#x4E3A;&#x5F53;&#x524D;&#x7684;&#x6E32;&#x67D3;  watcher  &#x5E76;&#x538B;&#x6808;&#xFF08;&#x4E3A;&#x4E86;&#x6062;&#x590D;&#x2F64;&#xFF09;&#x3002;&#x63A5;&#x7740;&#x2F1C;&#x6267;&#x2F8F;&#x4E86;&#xFF1A;</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript">value <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>getter<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> vm<span class="token punctuation">)</span>
</pre><p>this.getter  &#x5BF9;&#x5E94;&#x5C31;&#x662F;  updateComponent  &#x51FD;&#x6570;&#xFF0C;&#x8FD9;&#x5B9E;&#x9645;&#x4E0A;&#x5C31;&#x662F;&#x5728;&#x6267;&#x2F8F;&#xFF1A;</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript">vm<span class="token punctuation">.</span><span class="token function">_update</span><span class="token punctuation">(</span>vm<span class="token punctuation">.</span><span class="token function">_render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> hydrating<span class="token punctuation">)</span>
</pre><p>&#x5B83;&#x4F1A;&#x5148;&#x6267;&#x2F8F;  vm._render()  &#x2F45;&#x6CD5;&#xFF0C;&#x56E0;&#x4E3A;&#x8FD9;&#x4E2A;&#x2F45;&#x6CD5;&#x4F1A;&#x2F63;&#x6210; &#x6E32;&#x67D3; VNode(ps&#xFF1A;&#x7A0D;&#x5FAE;&#x63D0;&#x4E00;&#x4E0B;&#xFF0C;&#x4E0D;&#x662F;&#x672C;&#x6B21;&#x4E3B;&#x9898;&#x7684;&#x5185;&#x5BB9;)&#xFF0C;&#x5E76;&#x4E14;&#x5728;&#x8FD9;&#x4E2A;&#x8FC7;&#x7A0B;&#x4E2D;&#x4F1A;&#x5BF9;  vm  &#x4E0A;&#x7684;&#x6570;&#x636E;&#x8BBF;&#x95EE;&#xFF0C;&#x8FD9;&#x4E2A;&#x65F6;&#x5019;&#x5C31;&#x89E6;&#x53D1;&#x4E86;&#x6570;&#x636E;&#x5BF9;&#x8C61;&#x7684; getter&#x3002;<br>
&#x90A3;&#x4E48;&#x6BCF;&#x4E2A;&#x5BF9;&#x8C61;&#x503C;&#x7684; getter &#x90FD;&#x6301;&#x6709;&#x2F00;&#x4E2A;  dep  &#xFF0C;&#x5728;&#x89E6;&#x53D1; getter &#x7684;&#x65F6;&#x5019;&#x4F1A;&#x8C03;&#x2F64;  dep.depend()  &#x2F45;&#x6CD5;&#xFF0C;&#x4E5F;&#x5C31;&#x4F1A;&#x6267;&#x2F8F;  Dep.target.addDep(this)  &#x3002;</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token function">addDep</span> <span class="token punctuation">(</span>dep<span class="token punctuation">:</span> Dep<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> id <span class="token operator">=</span> dep<span class="token punctuation">.</span>id
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>newDepIds<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>newDepIds<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>newDeps<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>dep<span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>depIds<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      dep<span class="token punctuation">.</span><span class="token function">addSub</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</pre><pre data-role="codeBlock" data-info="js" class="language-javascript">  <span class="token function">addSub</span> <span class="token punctuation">(</span>sub<span class="token punctuation">:</span> Watcher<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>subs<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>sub<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
</pre><p>&#x8FD9;&#x65F6;&#x5019;&#x4F1A;&#x505A;&#x2F00;&#x4E9B;&#x903B;&#x8F91;&#x5224;&#x65AD;&#xFF08;&#x4FDD;&#x8BC1;&#x540C;&#x2F00;&#x6570;&#x636E;&#x4E0D;&#x4F1A;&#x88AB;&#x6DFB;&#x52A0;&#x591A;&#x6B21;&#xFF09;&#x540E;&#x6267;&#x2F8F;  dep.addSub(this)  &#xFF0C;&#x90A3;&#x4E48;&#x5C31;&#x4F1A;&#x6267;&#x2F8F;  this.subs.push(sub)  &#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x8BF4;&#x628A;&#x5F53;&#x524D;&#x7684;  watcher  &#x8BA2;&#x9605;&#x5230;&#x8FD9;&#x4E2A;&#x6570;&#x636E;&#x6301;&#x6709;&#x7684;  dep  &#x7684;  subs &#x4E2D;&#xFF0C;&#x8FD9;&#x4E2A;&#x2F6C;&#x7684;&#x662F;&#x4E3A;&#x540E;&#x7EED;&#x6570;&#x636E;&#x53D8;&#x5316;&#x65F6;&#x5019;&#x80FD;&#x901A;&#x77E5;&#x5230;&#x54EA;&#x4E9B;  subs  &#x505A;&#x51C6;&#x5907;&#x3002;<br>
&#x6240;&#x4EE5;&#x5728;  vm._render()  &#x8FC7;&#x7A0B;&#x4E2D;&#xFF0C;&#x4F1A;&#x89E6;&#x53D1;&#x6240;&#x6709;&#x6570;&#x636E;&#x7684; getter&#xFF0C;&#x8FD9;&#x6837;&#x5B9E;&#x9645;&#x4E0A;&#x5DF2;&#x7ECF;&#x5B8C;&#x6210;&#x4E86;&#x2F00;&#x4E2A;&#x4F9D;&#x8D56;&#x6536;&#x96C6;&#x7684;&#x8FC7;&#x7A0B;&#x3002;&#x90A3;&#x4E48;&#x5230;&#x8FD9;&#x2FA5;&#x5C31;&#x7ED3;&#x675F;&#x4E86;&#x4E48;&#xFF0C;&#x5176;&#x5B9E;&#x5E76;&#x6CA1;&#x6709;&#xFF0C;&#x518D;&#x5B8C;&#x6210;&#x4F9D;&#x8D56;&#x6536;&#x96C6;&#x540E;&#xFF0C;&#x8FD8;&#x6709;&#x2F0F;&#x4E2A;&#x903B;&#x8F91;&#x8981;&#x6267;&#x2F8F;&#xFF0C;&#x2FB8;&#x5148;&#x662F;&#xFF1A;</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>deep<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">traverse</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</pre><p>&#x8FD9;&#x4E2A;&#x662F;&#x8981;&#x9012;&#x5F52;&#x53BB;&#x8BBF;&#x95EE;  value  &#xFF0C;&#x89E6;&#x53D1;&#x5B83;&#x6240;&#x6709;&#x2F26;&#x9879;&#x7684;  getter  &#xFF0C;&#x8FD9;&#x4E2A;&#x4E4B;&#x540E;&#x4F1A;&#x8BE6;&#x7EC6;&#x8BB2;&#x3002;&#x7136;&#x540E;&#x6267;&#x884C;</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token function">popTarget</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</pre><p>popTarget&#x5B9A;&#x4E49;&#x5728;dep&#x4E2D;:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript">Dep<span class="token punctuation">.</span>target <span class="token operator">=</span> targetStack<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</pre><p>&#x5B9E;&#x9645;&#x4E0A;&#x5C31;&#x662F;&#x628A;  Dep.target  &#x6062;&#x590D;&#x6210;&#x4E0A;&#x2F00;&#x4E2A;&#x72B6;&#x6001;&#xFF0C;&#x56E0;&#x4E3A;&#x5F53;&#x524D; vm &#x7684;&#x6570;&#x636E;&#x4F9D;&#x8D56;&#x6536;&#x96C6;&#x5DF2;&#x7ECF;&#x5B8C;&#x6210;&#xFF0C;&#x90A3;&#x4E48;&#x5BF9;&#x5E94;&#x7684;&#x6E32;&#x67D3; Dep.target  &#x4E5F;&#x9700;&#x8981;&#x6539;&#x53D8;&#x3002;<br>
&#x6700;&#x540E;&#x6267;&#x884C;</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">cleanupDeps</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</pre><pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token function">cleanupDeps</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>deps<span class="token punctuation">.</span>length
  <span class="token keyword">while</span> <span class="token punctuation">(</span>i<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> dep <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>deps<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>newDepIds<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span>dep<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      dep<span class="token punctuation">.</span><span class="token function">removeSub</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">let</span> tmp <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>depIds
  <span class="token keyword">this</span><span class="token punctuation">.</span>depIds <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>newDepIds
  <span class="token keyword">this</span><span class="token punctuation">.</span>newDepIds <span class="token operator">=</span> tmp
  <span class="token keyword">this</span><span class="token punctuation">.</span>newDepIds<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  tmp <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>deps
  <span class="token keyword">this</span><span class="token punctuation">.</span>deps <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>newDeps
  <span class="token keyword">this</span><span class="token punctuation">.</span>newDeps <span class="token operator">=</span> tmp
  <span class="token keyword">this</span><span class="token punctuation">.</span>newDeps<span class="token punctuation">.</span>length <span class="token operator">=</span> <span class="token number">0</span>
<span class="token punctuation">}</span>
</pre><p>&#x8003;&#x8651;&#x5230; Vue &#x662F;&#x6570;&#x636E;&#x9A71;&#x52A8;&#x7684;&#xFF0C;&#x6240;&#x4EE5;&#x6BCF;&#x6B21;&#x6570;&#x636E;&#x53D8;&#x5316;&#x90FD;&#x4F1A;&#x91CD;&#x65B0; render&#xFF0C;&#x90A3;&#x4E48;  vm._render()  &#x2F45;&#x6CD5;&#x2F1C;&#x4F1A;&#x518D;&#x6B21;&#x6267;&#x2F8F;&#xFF0C;&#x5E76;&#x518D;&#x6B21;&#x89E6;&#x53D1;&#x6570;&#x636E;&#x7684; getters&#xFF0C;&#x6240;&#x4EE5;  Wathcer  &#x5728;&#x6784;&#x9020;&#x51FD;&#x6570;&#x4E2D;&#x4F1A;&#x521D;&#x59CB;&#x5316; 2 &#x4E2A;  Dep  &#x5B9E;&#x4F8B;&#x6570;&#x7EC4;&#xFF0C; newDeps  &#x8868;&#x2F70;&#x65B0;&#x6DFB;&#x52A0;&#x7684;  Dep  &#x5B9E;&#x4F8B;&#x6570;&#x7EC4;&#xFF0C;&#x2F7D;  deps  &#x8868;&#x2F70;&#x4E0A;&#x2F00;&#x6B21;&#x6DFB;&#x52A0;&#x7684;  Dep  &#x5B9E;&#x4F8B;&#x6570;&#x7EC4;&#x3002;<br>
&#x5728;&#x6267;&#x2F8F;  cleanupDeps  &#x51FD;&#x6570;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x4F1A;&#x2FB8;&#x5148;&#x904D;&#x5386;  deps  &#xFF0C;&#x79FB;&#x9664;&#x5BF9;  dep  &#x7684;&#x8BA2;&#x9605;&#xFF0C;&#x7136;&#x540E;&#x628A;  newDepIds&#x548C;  depIds  &#x4EA4;&#x6362;&#xFF0C; newDeps  &#x548C;  deps  &#x4EA4;&#x6362;&#xFF0C;&#x5E76;&#x628A;  newDepIds  &#x548C;  newDeps  &#x6E05;&#x7A7A;&#x3002;<br>
&#x90A3;&#x4E48;&#x4E3A;&#x4EC0;&#x4E48;&#x9700;&#x8981;&#x505A;  deps  &#x8BA2;&#x9605;&#x7684;&#x79FB;&#x9664;&#x5462;&#xFF0C;&#x5728;&#x6DFB;&#x52A0;  deps  &#x7684;&#x8BA2;&#x9605;&#x8FC7;&#x7A0B;&#xFF0C;&#x5DF2;&#x7ECF;&#x80FD;&#x901A;&#x8FC7;  id  &#x53BB;&#x91CD;&#x907F;&#x514D;&#x91CD;&#x590D;&#x8BA2;&#x9605;&#x4E86;&#x3002;<br>
&#x8003;&#x8651;&#x5230;&#x2F00;&#x79CD;&#x573A;&#x666F;&#xFF0C;&#x6211;&#x4EEC;&#x7684;&#x6A21;&#x677F;&#x4F1A;&#x6839;&#x636E;  v-if  &#x53BB;&#x6E32;&#x67D3;&#x4E0D;&#x540C;&#x2F26;&#x6A21;&#x677F; a &#x548C; b&#xFF0C;&#x5F53;&#x6211;&#x4EEC;&#x6EE1;&#x2F9C;&#x67D0;&#x79CD;&#x6761;&#x4EF6;&#x7684;&#x65F6;&#x5019;&#x6E32;&#x67D3; a &#x7684;&#x65F6;&#x5019;&#xFF0C;&#x4F1A;&#x8BBF;&#x95EE;&#x5230; a &#x4E2D;&#x7684;&#x6570;&#x636E;&#xFF0C;&#x8FD9;&#x65F6;&#x5019;&#x6211;&#x4EEC;&#x5BF9; a &#x4F7F;&#x2F64;&#x7684;&#x6570;&#x636E;&#x6DFB;&#x52A0;&#x4E86; getter&#xFF0C;&#x505A;&#x4E86;&#x4F9D;&#x8D56;&#x6536;&#x96C6;&#xFF0C;&#x90A3;&#x4E48;&#x5F53;&#x6211;&#x4EEC;&#x53BB;&#x4FEE;&#x6539; a &#x7684;&#x6570;&#x636E;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x7406;&#x5E94;&#x901A;&#x77E5;&#x5230;&#x8FD9;&#x4E9B;&#x8BA2;&#x9605;&#x8005;&#x3002;&#x90A3;&#x4E48;&#x5982;&#x679C;&#x6211;&#x4EEC;&#x2F00;&#x65E6;&#x6539;&#x53D8;&#x4E86;&#x6761;&#x4EF6;&#x6E32;&#x67D3;&#x4E86; b &#x6A21;&#x677F;&#xFF0C;&#x2F1C;&#x4F1A;&#x5BF9; b &#x4F7F;&#x2F64;&#x7684;&#x6570;&#x636E;&#x6DFB;&#x52A0;&#x4E86; getter&#xFF0C;&#x5982;&#x679C;&#x6211;&#x4EEC;&#x6CA1;&#x6709;&#x4F9D;&#x8D56;&#x79FB;&#x9664;&#x7684;&#x8FC7;&#x7A0B;&#xFF0C;&#x90A3;&#x4E48;&#x8FD9;&#x65F6;&#x5019;&#x6211;&#x53BB;&#x4FEE;&#x6539; a &#x6A21;&#x677F;&#x7684;&#x6570;&#x636E;&#xFF0C;&#x4F1A;&#x901A;&#x77E5; a &#x6570;&#x636E;&#x7684;&#x8BA2;&#x9605;&#x7684;&#x56DE;&#x8C03;&#xFF0C;&#x8FD9;&#x663E;&#x7136;&#x662F;&#x6709;&#x6D6A;&#x8D39;&#x7684;&#x3002;<br>
&#x56E0;&#x6B64; Vue &#x8BBE;&#x8BA1;&#x4E86;&#x5728;&#x6BCF;&#x6B21;&#x6DFB;&#x52A0;&#x5B8C;&#x65B0;&#x7684;&#x8BA2;&#x9605;&#xFF0C;&#x4F1A;&#x79FB;&#x9664;&#x6389;&#x65E7;&#x7684;&#x8BA2;&#x9605;&#xFF0C;&#x8FD9;&#x6837;&#x5C31;&#x4FDD;&#x8BC1;&#x4E86;&#x5728;&#x6211;&#x4EEC;&#x521A;&#x624D;&#x7684;&#x573A;&#x666F;&#x4E2D;&#xFF0C;&#x5982;&#x679C;&#x6E32;&#x67D3; b &#x6A21;&#x677F;&#x7684;&#x65F6;&#x5019;&#x53BB;&#x4FEE;&#x6539; a &#x6A21;&#x677F;&#x7684;&#x6570;&#x636E;&#xFF0C;a &#x6570;&#x636E;&#x8BA2;&#x9605;&#x56DE;&#x8C03;&#x5DF2;&#x7ECF;&#x88AB;&#x79FB;&#x9664;&#x4E86;&#xFF0C;&#x6240;&#x4EE5;&#x4E0D;&#x4F1A;&#x6709;&#x4EFB;&#x4F55;&#x6D6A;&#x8D39;&#x3002;</p>
<h2 class="mume-header" id="%E6%B4%BE%E5%8F%91%E6%9B%B4%E6%96%B0">&#x6D3E;&#x53D1;&#x66F4;&#x65B0;</h2>

<p>&#x56DE;&#x987E;&#x4E00;&#x4E0B;setter</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token comment">/**
 * Define a reactive property on an Object.
 */</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">defineReactive</span> <span class="token punctuation">(</span>
  obj<span class="token punctuation">:</span> Object<span class="token punctuation">,</span>
  key<span class="token punctuation">:</span> string<span class="token punctuation">,</span>
  val<span class="token punctuation">:</span> any<span class="token punctuation">,</span>
  customSetter<span class="token operator">?</span><span class="token punctuation">:</span> <span class="token operator">?</span>Function<span class="token punctuation">,</span>
  shallow<span class="token operator">?</span><span class="token punctuation">:</span> boolean
<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> dep <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Dep</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

  <span class="token keyword">const</span> property <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">getOwnPropertyDescriptor</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> key<span class="token punctuation">)</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>property <span class="token operator">&amp;&amp;</span> property<span class="token punctuation">.</span>configurable <span class="token operator">===</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// cater for pre-defined getter/setters</span>
  <span class="token keyword">const</span> getter <span class="token operator">=</span> property <span class="token operator">&amp;&amp;</span> property<span class="token punctuation">.</span><span class="token keyword">get</span>
  <span class="token keyword">const</span> setter <span class="token operator">=</span> property <span class="token operator">&amp;&amp;</span> property<span class="token punctuation">.</span><span class="token keyword">set</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">!</span>getter <span class="token operator">||</span> setter<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> arguments<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    val <span class="token operator">=</span> obj<span class="token punctuation">[</span>key<span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// &#x9012;&#x5F52;&#x8C03;&#x7528;observe&#xFF0C;&#x67D0;&#x4E2A;&#x5BF9;&#x8C61;&#x7684;&#x5C5E;&#x6027;&#x503C;&#x662F;&#x5BF9;&#x8C61;&#x65F6;&#xFF0C;&#x4F1A;&#x9012;&#x5F52;&#x8C03;&#x7528;observe</span>
  <span class="token keyword">let</span> childOb <span class="token operator">=</span> <span class="token operator">!</span>shallow <span class="token operator">&amp;&amp;</span> <span class="token function">observe</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span>
  Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> key<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    enumerable<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    configurable<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token keyword">get</span><span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token function">reactiveGetter</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> value <span class="token operator">=</span> getter <span class="token operator">?</span> getter<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span> <span class="token punctuation">:</span> val
      <span class="token keyword">if</span> <span class="token punctuation">(</span>Dep<span class="token punctuation">.</span>target<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        dep<span class="token punctuation">.</span><span class="token function">depend</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>childOb<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          childOb<span class="token punctuation">.</span>dep<span class="token punctuation">.</span><span class="token function">depend</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">dependArray</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">return</span> value
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token keyword">set</span><span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token function">reactiveSetter</span> <span class="token punctuation">(</span>newVal<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> value <span class="token operator">=</span> getter <span class="token operator">?</span> getter<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span> <span class="token punctuation">:</span> val
      <span class="token comment">/* eslint-disable no-self-compare */</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>newVal <span class="token operator">===</span> value <span class="token operator">||</span> <span class="token punctuation">(</span>newVal <span class="token operator">!==</span> newVal <span class="token operator">&amp;&amp;</span> value <span class="token operator">!==</span> value<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span>
      <span class="token punctuation">}</span>
      <span class="token comment">/* eslint-enable no-self-compare */</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">!==</span> <span class="token string">&apos;production&apos;</span> <span class="token operator">&amp;&amp;</span> customSetter<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">customSetter</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>setter<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        setter<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> newVal<span class="token punctuation">)</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        val <span class="token operator">=</span> newVal
      <span class="token punctuation">}</span>
      childOb <span class="token operator">=</span> <span class="token operator">!</span>shallow <span class="token operator">&amp;&amp;</span> <span class="token function">observe</span><span class="token punctuation">(</span>newVal<span class="token punctuation">)</span>
      dep<span class="token punctuation">.</span><span class="token function">notify</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</pre><ol>
<li>childOb = !shallow &amp;&amp; observe(newVal)  &#xFF0C;&#x5982;&#x679C;  shallow&#x4E3A; false &#x7684;&#x60C5;&#x51B5;&#xFF0C;&#x4F1A;&#x5BF9;&#x65B0;&#x8BBE;&#x7F6E;&#x7684;&#x503C;&#x53D8;&#x6210;&#x2F00;&#x4E2A;&#x54CD;&#x5E94;&#x5F0F;&#x5BF9;&#x8C61;</li>
<li>&#x53E6;&#x2F00;&#x4E2A;&#x662F;  dep.notify()  &#xFF0C;&#x901A;&#x77E5;&#x6240;&#x6709;&#x7684;&#x8BA2;&#x9605;&#x8005;</li>
</ol>
<h3 class="mume-header" id="%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90">&#x8FC7;&#x7A0B;&#x5206;&#x6790;</h3>

<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token keyword">class</span> <span class="token class-name">Dep</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token function">notify</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// stabilize the subscriber list first</span>
    <span class="token keyword">const</span> subs <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>subs<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> l <span class="token operator">=</span> subs<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> l<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      subs<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</pre><p>&#x904D;&#x5386;&#x6240;&#x6709;&#x7684;  subs  &#xFF0C;&#x4E5F;&#x5C31;&#x662F;  Watcher  &#x7684;&#x5B9E;&#x4F8B;&#x6570;&#x7EC4;&#xFF0C;&#x7136;&#x540E;&#x8C03;&#x2F64;&#x6BCF;&#x2F00;&#x4E2A;watcher  &#x7684;  update  &#x2F45;&#x6CD5;</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token keyword">class</span> <span class="token class-name">Watcher</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token function">update</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">/* istanbul ignore else */</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>computed<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// A computed property watcher has two modes: lazy and activated.</span>
      <span class="token comment">// It initializes as lazy by default, and only becomes activated when</span>
      <span class="token comment">// it is depended on by at least one subscriber, which is typically</span>
      <span class="token comment">// another computed property or a component&apos;s render function.</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>dep<span class="token punctuation">.</span>subs<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// In lazy mode, we don&apos;t want to perform computations until necessary,</span>
        <span class="token comment">// so we simply mark the watcher as dirty. The actual computation is</span>
        <span class="token comment">// performed just-in-time in this.evaluate() when the computed property</span>
        <span class="token comment">// is accessed.</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>dirty <span class="token operator">=</span> <span class="token boolean">true</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token comment">// In activated mode, we want to proactively perform the computation</span>
        <span class="token comment">// but only notify our subscribers when the value has indeed changed.</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getAndInvoke</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>dep<span class="token punctuation">.</span><span class="token function">notify</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>sync<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token function">queueWatcher</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</pre><p>&#x5BF9;&#x4E8E;  Watcher  &#x7684;&#x4E0D;&#x540C;&#x72B6;&#x6001;&#xFF0C;&#x4F1A;&#x6267;&#x2F8F;&#x4E0D;&#x540C;&#x7684;&#x903B;&#x8F91;&#xFF0C; computed  &#x548C;  sync  &#x7684;&#x5206;&#x652F;&#x8DF3;&#x8FC7;&#xFF0C;&#x5728;&#x2F00;&#x822C;&#x7EC4;&#x4EF6;&#x6570;&#x636E;&#x66F4;&#x65B0;&#x7684;&#x573A;&#x666F;&#xFF0C;&#x4F1A;&#x2F9B;&#x5230;&#x6700;&#x540E;&#x2F00;&#x4E2A;  queueWatcher(this)  &#x7684;&#x903B;&#x8F91;</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token keyword">const</span> queue<span class="token punctuation">:</span> Array<span class="token operator">&lt;</span>Watcher<span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token keyword">let</span> has<span class="token punctuation">:</span> <span class="token punctuation">{</span> <span class="token punctuation">[</span>key<span class="token punctuation">:</span> number<span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token operator">?</span><span class="token boolean">true</span> <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token keyword">let</span> waiting <span class="token operator">=</span> <span class="token boolean">false</span>
<span class="token keyword">let</span> flushing <span class="token operator">=</span> <span class="token boolean">false</span>
<span class="token comment">/**
* Push a watcher into the watcher queue.
* Jobs with duplicate IDs will be skipped unless it&apos;s
* pushed when the queue is being flushed.
*/</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">queueWatcher</span> <span class="token punctuation">(</span>watcher<span class="token punctuation">:</span> Watcher<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> id <span class="token operator">=</span> watcher<span class="token punctuation">.</span>id
  <span class="token keyword">if</span> <span class="token punctuation">(</span>has<span class="token punctuation">[</span>id<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    has<span class="token punctuation">[</span>id<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">true</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>flushing<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      queue<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>watcher<span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token comment">// if already flushing, splice the watcher based on its id</span>
    <span class="token comment">// if already past its id, it will be run next immediately.</span>
      <span class="token keyword">let</span> i <span class="token operator">=</span> queue<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span>
      <span class="token keyword">while</span> <span class="token punctuation">(</span>i <span class="token operator">&gt;</span> index <span class="token operator">&amp;&amp;</span> queue<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>id <span class="token operator">&gt;</span> watcher<span class="token punctuation">.</span>id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        i<span class="token operator">--</span>
      <span class="token punctuation">}</span>
      queue<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> watcher<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// queue the flush</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>waiting<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      waiting <span class="token operator">=</span> <span class="token boolean">true</span>
      <span class="token function">nextTick</span><span class="token punctuation">(</span>flushSchedulerQueue<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</pre><p>&#x8FD9;&#x2FA5;&#x5F15;&#x2F0A;&#x4E86;&#x2F00;&#x4E2A;&#x961F;&#x5217;&#x7684;&#x6982;&#x5FF5;&#xFF0C;&#x8FD9;&#x4E5F;&#x662F; Vue &#x5728;&#x505A;&#x6D3E;&#x53D1;&#x66F4;&#x65B0;&#x7684;&#x65F6;&#x5019;&#x7684;&#x2F00;&#x4E2A;&#x4F18;&#x5316;&#x7684;&#x70B9;&#xFF0C;&#x5B83;&#x5E76;&#x4E0D;&#x4F1A;&#x6BCF;&#x6B21;&#x6570;&#x636E;&#x6539;&#x53D8;&#x90FD;&#x89E6;&#x53D1;  watcher  &#x7684;&#x56DE;&#x8C03;&#xFF0C;&#x2F7D;&#x662F;&#x628A;&#x8FD9;&#x4E9B;  watcher  &#x5148;&#x6DFB;&#x52A0;&#x5230;&#x2F00;&#x4E2A;&#x961F;&#x5217;&#x2FA5;&#xFF0C;&#x7136;&#x540E;&#x5728;  nextTick  &#x540E;&#x6267;&#x2F8F;  flushSchedulerQueue &#x3002;<br>
&#x2FB8;&#x5148;&#x2F64;  has  &#x5BF9;&#x8C61;&#x4FDD;&#x8BC1;&#x540C;&#x2F00;&#x4E2A;  Watcher  &#x53EA;&#x6DFB;&#x52A0;&#x2F00;&#x6B21;&#xFF1B;&#x63A5;&#x7740;&#x5BF9;flushing  &#x7684;&#x5224;&#x65AD;&#xFF0C;else &#x90E8;&#x5206;&#x4E3A;&#x5206;&#x652F;&#x903B;&#x8F91;&#xFF0C;&#x4E0D;&#x505A;&#x8BE6;&#x7EC6;&#x8BF4;&#x660E;&#xFF1B;&#x6700;&#x540E;&#x901A;&#x8FC7;  wating  &#x4FDD;&#x8BC1;&#x5BF9;nextTick(flushSchedulerQueue)  &#x7684;&#x8C03;&#x2F64;&#x903B;&#x8F91;&#x53EA;&#x6709;&#x2F00;&#x6B21;&#x3002;</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token keyword">function</span> <span class="token function">flushSchedulerQueue</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  flushing <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> watcher<span class="token punctuation">,</span> id<span class="token punctuation">;</span>

  <span class="token comment">// Sort queue before flush.</span>
  <span class="token comment">// This ensures that:</span>
  <span class="token comment">// 1. Components are updated from parent to child. (because parent is always</span>
  <span class="token comment">//    created before the child)</span>
  <span class="token comment">// 2. A component&apos;s user watchers are run before its render watcher (because</span>
  <span class="token comment">//    user watchers are created before the render watcher)</span>
  <span class="token comment">// 3. If a component is destroyed during a parent component&apos;s watcher run,</span>
  <span class="token comment">//    its watchers can be skipped.</span>
  queue<span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> a<span class="token punctuation">.</span>id <span class="token operator">-</span> b<span class="token punctuation">.</span>id<span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// do not cache length because more watchers might be pushed</span>
  <span class="token comment">// as we run existing watchers</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span>index <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> index <span class="token operator">&lt;</span> queue<span class="token punctuation">.</span>length<span class="token punctuation">;</span> index<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    watcher <span class="token operator">=</span> queue<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>watcher<span class="token punctuation">.</span>before<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      watcher<span class="token punctuation">.</span><span class="token function">before</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    id <span class="token operator">=</span> watcher<span class="token punctuation">.</span>id<span class="token punctuation">;</span>
    has<span class="token punctuation">[</span>id<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    watcher<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// in dev build, check and stop circular updates.</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">&quot;development&quot;</span> <span class="token operator">!==</span> <span class="token string">&apos;production&apos;</span> <span class="token operator">&amp;&amp;</span> has<span class="token punctuation">[</span>id<span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      circular<span class="token punctuation">[</span>id<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>circular<span class="token punctuation">[</span>id<span class="token punctuation">]</span> <span class="token operator">||</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>circular<span class="token punctuation">[</span>id<span class="token punctuation">]</span> <span class="token operator">&gt;</span> <span class="token constant">MAX_UPDATE_COUNT</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">warn</span><span class="token punctuation">(</span>
          <span class="token string">&apos;You may have an infinite update loop &apos;</span> <span class="token operator">+</span> <span class="token punctuation">(</span>
            watcher<span class="token punctuation">.</span>user
              <span class="token operator">?</span> <span class="token punctuation">(</span><span class="token string">&quot;in watcher with expression \&quot;&quot;</span> <span class="token operator">+</span> <span class="token punctuation">(</span>watcher<span class="token punctuation">.</span>expression<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;\&quot;&quot;</span><span class="token punctuation">)</span>
              <span class="token punctuation">:</span> <span class="token string">&quot;in a component render function.&quot;</span>
          <span class="token punctuation">)</span><span class="token punctuation">,</span>
          watcher<span class="token punctuation">.</span>vm
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">break</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// keep copies of post queues before resetting state</span>
  <span class="token keyword">var</span> activatedQueue <span class="token operator">=</span> activatedChildren<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> updatedQueue <span class="token operator">=</span> queue<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">resetSchedulerState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// call component updated and activated hooks</span>
  <span class="token function">callActivatedHooks</span><span class="token punctuation">(</span>activatedQueue<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">callUpdatedHooks</span><span class="token punctuation">(</span>updatedQueue<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// devtool hook</span>
  <span class="token comment">/* istanbul ignore if */</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>devtools <span class="token operator">&amp;&amp;</span> config<span class="token punctuation">.</span>devtools<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    devtools<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">&apos;flush&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</pre><p>flushSchedulerQueue&#x91CC;&#x4F1A;&#x6267;&#x884C;&#x961F;&#x5217;&#x6392;&#x5E8F;&#x3001;&#x961F;&#x5217;&#x904D;&#x5386;&#x3001;&#x72B6;&#x6001;&#x6062;&#x590D;&#x7684;&#x8FC7;&#x7A0B;</p>
<h3 class="mume-header" id="%E9%98%9F%E5%88%97%E6%8E%92%E5%BA%8F">&#x961F;&#x5217;&#x6392;&#x5E8F;</h3>

<p>queue.sort((a, b) =&gt; <a href="http://a.id">a.id</a> - <a href="http://b.id">b.id</a>)  &#x5BF9;&#x961F;&#x5217;&#x505A;&#x4E86;&#x4ECE;&#x2F29;&#x5230;&#x2F24;&#x7684;&#x6392;&#x5E8F;&#xFF0C;&#x8FD9;&#x4E48;&#x505A;&#x4E3B;&#x8981;&#x6709;&#x4EE5;&#x4E0B;&#x8981;&#x786E;&#x4FDD;&#x4EE5;&#x4E0B;&#x2F0F;&#x70B9;&#xFF1A;</p>
<ol>
<li>&#x7EC4;&#x4EF6;&#x7684;&#x66F4;&#x65B0;&#x7531;&#x2F57;&#x5230;&#x2F26;&#xFF1B;&#x56E0;&#x4E3A;&#x2F57;&#x7EC4;&#x4EF6;&#x7684;&#x521B;&#x5EFA;&#x8FC7;&#x7A0B;&#x662F;&#x5148;&#x4E8E;&#x2F26;&#x7684;&#xFF0C;&#x6240;&#x4EE5;  watcher  &#x7684;&#x521B;&#x5EFA;&#x4E5F;&#x662F;&#x5148;&#x2F57;&#x540E;&#x2F26;&#xFF0C;&#x6267;&#x2F8F;&#x987A;&#x5E8F;&#x4E5F;&#x5E94;&#x8BE5;&#x4FDD;&#x6301;&#x5148;&#x2F57;&#x540E;&#x2F26;&#x3002;</li>
<li>&#x2F64;&#x6237;&#x7684;&#x2F83;&#x5B9A;&#x4E49;  watcher  &#x8981;&#x4F18;&#x5148;&#x4E8E;&#x6E32;&#x67D3;  watcher  &#x6267;&#x2F8F;&#xFF1B;&#x56E0;&#x4E3A;&#x2F64;&#x6237;&#x2F83;&#x5B9A;&#x4E49;  watcher  &#x662F;&#x5728;&#x6E32;&#x67D3; watcher  &#x4E4B;&#x524D;&#x521B;&#x5EFA;&#x7684;&#x3002;</li>
<li>&#x5982;&#x679C;&#x2F00;&#x4E2A;&#x7EC4;&#x4EF6;&#x5728;&#x2F57;&#x7EC4;&#x4EF6;&#x7684;  watcher  &#x6267;&#x2F8F;&#x671F;&#x95F4;&#x88AB;&#x9500;&#x6BC1;&#xFF0C;&#x90A3;&#x4E48;&#x5B83;&#x5BF9;&#x5E94;&#x7684;  watcher  &#x6267;&#x2F8F;&#x90FD;&#x53EF;&#x4EE5;&#x88AB;&#x8DF3;&#x8FC7;&#xFF0C;&#x6240;&#x4EE5;&#x2F57;&#x7EC4;&#x4EF6;&#x7684;  watcher  &#x5E94;&#x8BE5;&#x5148;&#x6267;&#x2F8F;&#x3002;</li>
</ol>
<h3 class="mume-header" id="%E9%98%9F%E5%88%97%E9%81%8D%E5%8E%86">&#x961F;&#x5217;&#x904D;&#x5386;</h3>

<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">queueWatcher</span> <span class="token punctuation">(</span>watcher<span class="token punctuation">:</span> Watcher<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> id <span class="token operator">=</span> watcher<span class="token punctuation">.</span>id
  <span class="token keyword">if</span> <span class="token punctuation">(</span>has<span class="token punctuation">[</span>id<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    has<span class="token punctuation">[</span>id<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">true</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>flushing<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      queue<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>watcher<span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token comment">// if already flushing, splice the watcher based on its id</span>
    <span class="token comment">// if already past its id, it will be run next immediately.</span>
    <span class="token keyword">let</span> i <span class="token operator">=</span> queue<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span>i <span class="token operator">&gt;</span> index <span class="token operator">&amp;&amp;</span> queue<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>id <span class="token operator">&gt;</span> watcher<span class="token punctuation">.</span>id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      i<span class="token operator">--</span>
    <span class="token punctuation">}</span>
    queue<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> watcher<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</pre><p>&#x904D;&#x5386;&#x6267;&#x884C;watcher.run()</p>
<h3 class="mume-header" id="watcherrun">watcher.run()</h3>

<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token keyword">class</span> <span class="token class-name">Watcher</span> <span class="token punctuation">{</span>
  <span class="token comment">/**
   * * Scheduler job interface.
  * Will be called by the scheduler.
  */</span>
  <span class="token function">run</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>active<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getAndInvoke</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>cb<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token function">getAndInvoke</span> <span class="token punctuation">(</span>cb<span class="token punctuation">:</span> Function<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> value <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>
      value <span class="token operator">!==</span> <span class="token keyword">this</span><span class="token punctuation">.</span>value <span class="token operator">||</span>
      <span class="token comment">// Deep watchers and watchers on Object/Arrays should fire even</span>
      <span class="token comment">// when the value is the same, because the value may</span>
      <span class="token comment">// have mutated.</span>
      <span class="token function">isObject</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token operator">||</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>deep
    <span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// set new value</span>
      <span class="token keyword">const</span> oldValue <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>value
      <span class="token keyword">this</span><span class="token punctuation">.</span>value <span class="token operator">=</span> value
      <span class="token keyword">this</span><span class="token punctuation">.</span>dirty <span class="token operator">=</span> <span class="token boolean">false</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>user<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
          cb<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>vm<span class="token punctuation">,</span> value<span class="token punctuation">,</span> oldValue<span class="token punctuation">)</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token function">handleError</span><span class="token punctuation">(</span>e<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>vm<span class="token punctuation">,</span> <span class="token template-string"><span class="token string">`callback for watcher &quot;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>expression<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&quot;`</span></span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        cb<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>vm<span class="token punctuation">,</span> value<span class="token punctuation">,</span> oldValue<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</pre><p>run  &#x51FD;&#x6570;&#x5B9E;&#x9645;&#x4E0A;&#x5C31;&#x662F;&#x6267;&#x2F8F;  this.getAndInvoke  &#x2F45;&#x6CD5;&#xFF0C;&#x5E76;&#x4F20;&#x2F0A;  watcher  &#x7684;&#x56DE;&#x8C03;&#x51FD;&#x6570;&#x3002; getAndInvoke  &#x51FD;&#x6570;&#x903B;&#x8F91;&#x4E5F;&#x5F88;&#x7B80;&#x5355;&#xFF0C;&#x5148;&#x901A;&#x8FC7;  this.get()  &#x5F97;&#x5230;&#x5B83;&#x5F53;&#x524D;&#x7684;&#x503C;&#xFF0C;&#x7136;&#x540E;&#x505A;&#x5224;&#x65AD;&#xFF0C;&#x5982;&#x679C;&#x6EE1;&#x2F9C;&#x65B0;&#x65E7;&#x503C;&#x4E0D;&#x7B49;&#x3001;&#x65B0;&#x503C;&#x662F;&#x5BF9;&#x8C61;&#x7C7B;&#x578B;&#x3001; deep  &#x6A21;&#x5F0F;&#x4EFB;&#x4F55;&#x2F00;&#x4E2A;&#x6761;&#x4EF6;&#xFF0C;&#x5219;&#x6267;&#x2F8F;  watcher  &#x7684;&#x56DE;&#x8C03;&#xFF0C;&#x6CE8;&#x610F;&#x56DE;&#x8C03;&#x51FD;&#x6570;&#x6267;&#x2F8F;&#x7684;&#x65F6;&#x5019;&#x4F1A;&#x628A;&#x7B2C;&#x2F00;&#x4E2A;&#x548C;&#x7B2C;&#x2F06;&#x4E2A;&#x53C2;&#x6570;&#x4F20;&#x2F0A;&#x65B0;&#x503C;  value  &#x548C;&#x65E7;&#x503C;  oldValue  &#xFF0C;&#x8FD9;&#x5C31;&#x662F;&#x5F53;&#x6211;&#x4EEC;&#x6DFB;&#x52A0;&#x2F83;&#x5B9A;&#x4E49;  watcher  &#x7684;&#x65F6;&#x5019;&#x80FD;&#x5728;&#x56DE;&#x8C03;&#x51FD;&#x6570;&#x7684;&#x53C2;&#x6570;&#x4E2D;&#x62FF;&#x5230;&#x65B0;&#x65E7;&#x503C;&#x7684;&#x539F;&#x56E0;&#x3002;<br>
&#x90A3;&#x4E48;&#x5BF9;&#x4E8E;&#x6E32;&#x67D3;  watcher  &#x2F7D;&#x2F94;&#xFF0C;&#x5B83;&#x5728;&#x6267;&#x2F8F;  this.get()  &#x2F45;&#x6CD5;&#x6C42;&#x503C;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x4F1A;&#x6267;&#x2F8F;  getter  &#x2F45;&#x6CD5;&#xFF1A;</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token function-variable function">updateComponent</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  vm<span class="token punctuation">.</span><span class="token function">_update</span><span class="token punctuation">(</span>vm<span class="token punctuation">.</span><span class="token function">_render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> hydrating<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</pre><p>&#x6700;&#x7EC8;&#x4F1A;&#x6267;&#x884C;vm._update()&#x65B9;&#x6CD5;&#x8FDB;&#x884C;DOM&#x7684;&#x66F4;&#x65B0;&#xFF0C;&#x5173;&#x4E8E;&#x54CD;&#x5E94;&#x5F0F;&#x5BF9;&#x8C61;&#x7684;&#x5206;&#x6790;&#x5C31;&#x5230;&#x8FD9;&#x91CC;&#x7ED3;&#x675F;&#x4E86;&#xFF0C;&#x60F3;&#x8D70;&#x4E00;&#x904D;&#x6D41;&#x7A0B;&#x7684;&#x53EF;&#x4EE5;&#x81EA;&#x5DF1;&#x53BB;&#x6253;&#x65AD;&#x70B9;&#x7814;&#x7A76;&#x4E00;&#x4E0B;&#xFF0C;&#x65AD;&#x70B9;&#x6253;&#x5728;node_modules/vue/dist/vue.esm.js&#x6587;&#x4EF6;&#x4E2D;&#xFF0C;&#x53EF;&#x4EE5;&#x4ECE;initData&#x5F00;&#x59CB;&#x3002;</p>

      </div>
      
      
    
    
    
    
    
    
    
    
  
    </body></html>